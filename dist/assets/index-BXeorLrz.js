import{c as Ct,r as u,j as e,u as h,a as Fe,L as T,B as U,S as ae,b as _e,X as H,M as Et,H as _t,C as Ae,d as O,e as ie,f as Ge,g as $e,h as Me,i as Ue,k as M,I as Oe,l as Ke,A as qe,Z as He,F as ne,m as We,P as Y,n as Ve,o as Bt,p as ze,q as le,T as Lt,s as be,t as It,U as J,v as Tt,w as Rt,x as ye,y as pe,z as Z,R as fe,D as ve,E as je,G as ke,J as we,K as Ne,N as ue,O as se,Q as Pt,V as Ft,W as At,Y as Be,_ as Qe,$ as Gt,a0 as $t,a1 as Mt,a2 as $,a3 as ge,a4 as Ut,a5 as Ot,a6 as Kt,a7 as qt,a8 as Ht,a9 as Wt}from"./vendor-BnK7FYi0.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function a(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=a(n);fetch(n.href,i)}})();const Vt="https://gokqhgrqpigwicuojlzh.supabase.co",zt="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imdva3FoZ3JxcGlnd2ljdW9qbHpoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzg0NTg4MTQsImV4cCI6MjA1NDAzNDgxNH0.fmb06Aa3cF08rS7dqQhE2fDBODZ6PsztYm0575ac6HI",j=Ct(Vt,zt,{auth:{persistSession:!0},global:{fetch:(...t)=>{const r=async(a=1,s=3)=>{try{return await fetch(...t)}catch(n){if(a<s)return await new Promise(i=>setTimeout(i,Math.pow(2,a)*1e3)),r(a+1,s);throw n}};return r()}}});async function Ye(t,r){if(!r)return null;try{const{data:a,error:s}=await j.storage.from(t).createSignedUrl(r,3600);return s?(console.error("Error getting signed URL:",s),null):a.signedUrl}catch(a){return console.error("Error getting signed URL:",a),null}}async function Qt(){const{data:t,error:r}=await j.auth.signInWithOAuth({provider:"google",options:{redirectTo:window.location.origin}});if(r)throw r;return t}async function Yt(){const{error:t}=await j.auth.signOut();if(t)throw t;return!0}async function Je(){const{data:t,error:r}=await j.auth.getUser();if(r)throw r;return t.user}async function Ze(){const{data:t,error:r}=await j.auth.getSession();if(r)throw r;return t}function Xe(t){const{data:r}=j.auth.onAuthStateChange(t);return r}const et=u.createContext({user:null,loading:!0});function Jt({children:t}){const[r,a]=u.useState(null),[s,n]=u.useState(!0);return u.useEffect(()=>{Ze().then(({session:l})=>{a((l==null?void 0:l.user)??null),n(!1)});const{subscription:i}=Xe((l,d)=>{a((d==null?void 0:d.user)??null)});return()=>i.unsubscribe()},[]),e.jsx(et.Provider,{value:{user:r,loading:s},children:t})}function K(){return u.useContext(et)}function Zt(){const{t}=h(),a=Fe().pathname,[s,n]=u.useState(!1),l=a==="/"||a.startsWith("/batteries")?"batteries":"devices";return e.jsxs("nav",{className:"bg-white dark:bg-dark-card shadow",children:[e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0 flex items-center",children:e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-dark-text",children:t("app.title")})}),e.jsxs("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[e.jsxs(T,{to:"/batteries",className:`inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ${l==="batteries"?"border-blue-500 text-gray-900 dark:text-dark-text":"border-transparent text-gray-500 dark:text-gray-400 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(U,{className:"mr-2 h-5 w-5"}),t("nav.batteries")]}),e.jsxs(T,{to:"/devices",className:`inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ${l==="devices"?"border-blue-500 text-gray-900 dark:text-dark-text":"border-transparent text-gray-500 dark:text-gray-400 hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-300"}`,children:[e.jsx(ae,{className:"mr-2 h-5 w-5"}),t("nav.devices")]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx(T,{to:"/settings",className:"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-300",title:t("userSettings.title"),children:e.jsx(_e,{className:"h-5 w-5"})}),e.jsx("div",{className:"-mr-2 flex items-center sm:hidden",children:e.jsx("button",{onClick:()=>n(!s),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-400 hover:bg-gray-100 dark:hover:bg-dark-bg focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",children:s?e.jsx(H,{className:"block h-6 w-6"}):e.jsx(Et,{className:"block h-6 w-6"})})})]})]})}),e.jsx("div",{className:`${s?"block":"hidden"} sm:hidden`,children:e.jsxs("div",{className:"pt-2 pb-3 space-y-1",children:[e.jsx(T,{to:"/batteries",className:`${l==="batteries"?"bg-blue-50 dark:bg-blue-900/50 border-blue-500 text-blue-700 dark:text-blue-300":"border-transparent text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-dark-bg hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-300"} block pl-3 pr-4 py-2 border-l-4 text-base font-medium`,onClick:()=>n(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"mr-2 h-5 w-5"}),t("nav.batteries")]})}),e.jsx(T,{to:"/devices",className:`${l==="devices"?"bg-blue-50 dark:bg-blue-900/50 border-blue-500 text-blue-700 dark:text-blue-300":"border-transparent text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-dark-bg hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-300"} block pl-3 pr-4 py-2 border-l-4 text-base font-medium`,onClick:()=>n(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ae,{className:"mr-2 h-5 w-5"}),t("nav.devices")]})}),e.jsx(T,{to:"/settings",className:"block pl-3 pr-4 py-2 border-l-4 border-transparent text-gray-500 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-dark-bg hover:border-gray-300 hover:text-gray-700 dark:hover:text-gray-300",onClick:()=>n(!1),children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(_e,{className:"mr-2 h-5 w-5"}),t("userSettings.title")]})})]})})]})}function Xt(){const{t}=h(),a=Fe().pathname,[s,n]=u.useState([]);return u.useEffect(()=>{const i=a.split("/").filter(Boolean),l=[];i.reduce((d,o,m)=>{const g=`${d}/${o}`;let b=o;switch(o){case"batteries":b=t("nav.batteries");break;case"devices":b=t("nav.devices");break;case"new":b=t("nav.new");break;case"select-battery":b=t("nav.selectBattery");break;default:o.length>=2&&!isNaN(+("0x"+o.substring(0,2)))&&(m>0&&i[m-1]==="devices"||m>0&&i[m-1]==="batteries")&&(b=t("nav.detail"))}return l.push({name:b,href:g}),g},""),n(l)},[a]),s.length===0?null:e.jsxs("nav",{className:"flex items-center space-x-2 text-sm text-gray-500 dark:text-gray-400 mb-4",children:[e.jsx(T,{to:"/",className:"hover:text-gray-700 dark:hover:text-gray-300",children:e.jsx(_t,{className:"w-4 h-4"})}),s.map((i,l)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ae,{className:"w-4 h-4 text-gray-400 dark:text-gray-500"}),e.jsx(T,{to:i.href,className:`hover:text-gray-700 dark:hover:text-gray-300 ${l===s.length-1?"text-gray-900 dark:text-dark-text font-medium":""}`,children:i.name})]},i.href))]})}const tt={free:{batteryGroups:0,devices:0},standard:{batteryGroups:20,devices:20},pro:{batteryGroups:45,devices:45}};function at(t){const r=tt[t.plan_type];return{batteryGroups:t.max_battery_groups+r.batteryGroups,devices:t.max_devices+r.devices}}function ea(t){switch(t){case"premium":return"standard";case"business":return"pro";default:return t}}function Le(t,r,a){const s=tt[r.plan_type],n=a==="batteryGroups"?r.max_battery_groups+s.batteryGroups:r.max_devices+s.devices;return t>=n}async function rt(t){const{data:r,error:a}=await j.from("user_plans").select("*").eq("user_id",t).single();if(a)throw a;return{max_battery_groups:r.max_battery_groups,max_devices:r.max_devices,plan_type:ea(r.plan_type)}}async function ta(){const{data:t,error:r}=await j.from("devices").select("*").order("created_at",{ascending:!1});if(r)throw r;return t}async function aa(t){const{data:r,error:a}=await j.from("devices").select("*").eq("id",t).single();if(a)throw a;return r}async function ra(t){const{data:r,error:a}=await j.from("devices").insert(t).select().single();if(a)throw a;return r}async function sa(t,r){const{data:a,error:s}=await j.from("devices").update(r).eq("id",t).select().single();if(s)throw s;return a}async function na(t){const{error:r}=await j.from("devices").delete().eq("id",t);if(r)throw r;return!0}async function ia(t){const{data:r,error:a}=await j.from("batteries").select(`
      *,
      battery_groups (*)
    `).eq("device_id",t).order("slot_number",{ascending:!0});if(a)throw a;return r}async function la(t){const r=new Date().toISOString(),{data:a,error:s}=await j.from("devices").update({last_battery_change:r}).eq("id",t).select().single();if(s)throw s;return a}async function da(t){const r=new Date().toISOString(),{data:a,error:s}=await j.from("batteries").update({device_id:null,status:"empty",last_checked:r}).eq("device_id",t).select();if(s)throw s;return a}async function oa(){const{data:t,error:r}=await j.from("battery_groups").select(`
      *,
      batteries (
        *,
        devices (
          id,
          name
        )
      )
    `).order("created_at",{ascending:!1});if(r)throw r;return t}async function ca(t){const{data:r,error:a}=await j.from("battery_groups").select(`
      *,
      batteries (
        *,
        devices (
          *
        )
      )
    `).eq("id",t).single();if(a)throw a;return r}async function ma(t,r){const{data:a,error:s}=await j.from("battery_groups").update(r).eq("id",t).select().single();if(s)throw s;return a}async function ua(t){const{error:r}=await j.from("battery_groups").delete().eq("id",t);if(r)throw r;return!0}async function ga(t){let r=j.from("batteries").select(`
      *,
      battery_groups (*),
      devices (*)
    `);t&&(r=r.eq("group_id",t));const{data:a,error:s}=await r;if(s)throw s;return a}async function xa(t){const{data:r,error:a}=await j.from("batteries").insert(t).select();if(a)throw a;return r}async function ha(t,r){if(t.length===0)return[];const{data:a,error:s}=await j.from("batteries").update(r).in("id",t).select();if(s)throw s;return a}async function ba(t){const{data:r,error:a}=await j.from("battery_groups").select(`
      id,
      name,
      shape,
      type,
      kind,
      count,
      voltage,
      notes,
      image_url,
      created_at,
      user_id,
      batteries!inner (
        id,
        group_id,
        slot_number,
        status,
        last_checked,
        last_changed_at,
        device_id,
        created_at,
        user_id,
        devices:device_id (
          id,
          name
        )
      )
    `).eq("shape",t).order("created_at",{ascending:!1});if(a)throw a;return r}async function ya(t,r){const a=new Date().toISOString(),s={status:r,last_checked:a};(r==="charged"||r==="in_use")&&(s.last_changed_at=a);const{data:n,error:i}=await j.from("batteries").update(s).eq("id",t).select();if(i)throw i;return n}async function pa(t){try{const r=new Date().toISOString(),{data:a,error:s}=await j.from("batteries").select("device_id").eq("id",t).single();if(s)throw s;if(!a.device_id)return!1;const n=a.device_id,{error:i}=await j.from("batteries").update({device_id:null,status:"empty",last_changed_at:r}).eq("id",t);if(i)throw i;const{error:l}=await j.from("battery_usage_history").update({ended_at:r}).eq("battery_id",t).is("ended_at",null);if(l)throw l;const{data:d,error:o}=await j.from("batteries").select("id").eq("device_id",n);if(o)throw o;if(d.length<=1){const{error:m}=await j.from("devices").update({has_batteries:!1}).eq("id",n);if(m)throw m}return!0}catch(r){throw console.error("電池取り外しエラー:",r),r}}const A={BATTERY_GROUPS:"batteryGroups",BATTERY_GROUP:"batteryGroup",DEVICES:"devices",DEVICE:"device",AVAILABLE_BATTERIES:"availableBatteries",DEVICE_BATTERIES:"deviceBatteries",USER_PLAN:"userPlan"};function fa(){const{user:t}=K();return O({queryKey:[A.USER_PLAN,t==null?void 0:t.id],queryFn:async()=>t?await rt(t.id):null,enabled:!!t,staleTime:60*1e3})}function va(){return O({queryKey:[A.BATTERY_GROUPS],queryFn:async()=>await oa(),staleTime:0})}function ja(t){return O({queryKey:[A.BATTERY_GROUP,t],queryFn:async()=>await ca(t),staleTime:0})}function ka(t){return O({queryKey:["batteries",t],queryFn:async()=>await ga(t),staleTime:0,enabled:!!t})}function wa(){return O({queryKey:[A.DEVICES],queryFn:async()=>await ta(),staleTime:0})}function Na(t){return O({queryKey:[A.DEVICE,t],queryFn:async()=>await aa(t),staleTime:0})}function Sa(t){return O({queryKey:[A.DEVICE_BATTERIES,t],queryFn:async()=>await ia(t),staleTime:0,enabled:!!t})}function Da(t){return O({queryKey:[A.AVAILABLE_BATTERIES,t],queryFn:async()=>await ba(t),staleTime:0,enabled:!!t})}function Se(t){return{invalidateBatteries:()=>{t.invalidateQueries({queryKey:[A.BATTERY_GROUPS]}),t.invalidateQueries({queryKey:[A.BATTERY_GROUP]}),t.invalidateQueries({queryKey:[A.AVAILABLE_BATTERIES]}),t.invalidateQueries({queryKey:[A.DEVICE_BATTERIES]})},invalidateDevices:()=>{t.invalidateQueries({queryKey:[A.DEVICES]}),t.invalidateQueries({queryKey:[A.DEVICE]}),t.invalidateQueries({queryKey:[A.DEVICE_BATTERIES]})},invalidateUserPlan:()=>{t.invalidateQueries({queryKey:[A.USER_PLAN]})}}}const z=ie((t,r)=>({batteryGroups:[],devices:[],imageCache:{},setBatteryGroups:a=>t({batteryGroups:a}),setDevices:a=>t({devices:a}),updateBatteryGroup:(a,s)=>t(n=>({batteryGroups:n.batteryGroups.map(i=>i.id===a?{...i,...s}:i)})),updateDevice:(a,s)=>t(n=>({devices:n.devices.map(i=>i.id===a?{...i,...s}:i)})),addBatteryGroup:a=>t(s=>({batteryGroups:[a,...s.batteryGroups]})),addDevice:a=>t(s=>({devices:[a,...s.devices]})),setCachedImage:(a,s)=>t(n=>({imageCache:{...n.imageCache,[a]:s}})),getCachedImage:a=>r().imageCache[a]||null}));function st(){const{data:t,isLoading:r}=va(),a=z(s=>s.setBatteryGroups);return u.useEffect(()=>{t&&a(t)},[t,a]),{batteryGroups:z(s=>s.batteryGroups),loading:r}}function Ca(t){const{data:r,isLoading:a}=ja(t),{data:s,isLoading:n}=ka(t),i=z(l=>l.updateBatteryGroup);return u.useEffect(()=>{r&&i(t,r)},[r,t,i]),{batteryGroup:r??null,batteries:s??[],loading:a||n}}function nt(){const{data:t,isLoading:r}=wa(),a=z(s=>s.setDevices);return u.useEffect(()=>{t&&a(t)},[t,a]),{devices:z(s=>s.devices),loading:r}}function it(t){const{data:r,isLoading:a}=Na(t),{data:s,isLoading:n}=Sa(t),i=z(l=>l.updateDevice);return u.useEffect(()=>{r&&i(t,r)},[r,t,i]),{device:r??null,batteries:s??[],loading:a||n}}function X(){const{data:t,isLoading:r}=fa();return{userPlan:t,loading:r,isLimitReached:{batteryGroups:a=>t?Le(a,t,"batteryGroups"):!1,devices:a=>t?Le(a,t,"devices"):!1}}}function Ea(t){const{data:r,isLoading:a}=Da(t);return{availableBatteryGroups:r??[],loading:a}}function lt(){const[t,r]=u.useState(()=>{const a=localStorage.getItem("darkMode");return a!==null?a==="true":window.matchMedia("(prefers-color-scheme: dark)").matches});return u.useEffect(()=>{document.documentElement.classList.toggle("dark",t),localStorage.setItem("darkMode",String(t))},[t]),{isDark:t,toggle:()=>r(a=>!a),enable:()=>r(!0),disable:()=>r(!1)}}function _a(t){return Se(t)}const Ba={単1形:"https://images.unsplash.com/photo-1621360241147-d9ecddc46459?w=400&h=400&fit=crop",単2形:"https://images.unsplash.com/photo-1621360241147-d9ecddc46459?w=400&h=400&fit=crop",単3形:"https://images.unsplash.com/photo-1584269600464-37b1b58a9fe7?w=400&h=400&fit=crop",単4形:"https://images.unsplash.com/photo-1584269600519-0d15e1a71570?w=400&h=400&fit=crop","9V形":"https://images.unsplash.com/photo-1621360241147-d9ecddc46459?w=400&h=400&fit=crop"};async function dt(t,r){const{setCachedImage:a,getCachedImage:s}=z.getState();if(r){const n=s(r);if(n)return n;if(!r.startsWith("http")){const i=await Ye("battery-images",r);if(i)return a(r,i),i}return r}return Ba[t]}const ee=t=>({単1形:"battery.shape.d",単2形:"battery.shape.c",単3形:"battery.shape.aa",単4形:"battery.shape.aaa",単５形:"battery.shape.n","LR44/SR44":"battery.shape.lr44",CR2032:"battery.shape.cr2032",CR2025:"battery.shape.cr2025",CR2016:"battery.shape.cr2016","9V形":"battery.shape.9v",その他:"battery.shape.other"})[t]||t,La=[{value:"単1形",labelKey:"battery.shape.d"},{value:"単2形",labelKey:"battery.shape.c"},{value:"単3形",labelKey:"battery.shape.aa"},{value:"単4形",labelKey:"battery.shape.aaa"},{value:"単５形",labelKey:"battery.shape.n"},{value:"LR44/SR44",labelKey:"battery.shape.lr44"},{value:"CR2032",labelKey:"battery.shape.cr2032"},{value:"CR2025",labelKey:"battery.shape.cr2025"},{value:"CR2016",labelKey:"battery.shape.cr2016"},{value:"9V形",labelKey:"battery.shape.9v"},{value:"その他",labelKey:"battery.shape.other"}],he={charged:{icon:Ue,color:{background:"bg-green-100 dark:bg-green-900/20",text:"text-green-800 dark:text-green-300"}},in_use:{icon:Me,color:{background:"bg-blue-100 dark:bg-blue-900/20",text:"text-blue-800 dark:text-blue-300"}},empty:{icon:$e,color:{background:"bg-yellow-100 dark:bg-yellow-900/20",text:"text-yellow-800 dark:text-yellow-300"}},disposed:{icon:Ge,color:{background:"bg-red-100 dark:bg-red-900/20",text:"text-red-800 dark:text-red-300"}}},Ia=[{value:"disposable",labelKey:"battery.kind.disposable"},{value:"rechargeable",labelKey:"battery.kind.rechargeable"}];function ot({status:t,className:r=""}){const{t:a}=h(),n=(l=>{switch(l){case"charged":return{icon:Ue,text:a("battery.status.charged"),color:"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300"};case"in_use":return{icon:Me,text:a("battery.status.in_use"),color:"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300"};case"empty":return{icon:$e,text:a("battery.status.empty"),color:"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300"};case"disposed":return{icon:Ge,text:a("battery.status.disposed"),color:"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-300"};default:return{icon:U,text:a("battery.status.unknown"),color:"bg-gray-100 dark:bg-gray-800 text-gray-800 dark:text-gray-300"}}})(t),i=n.icon;return e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${n.color} ${r}`,children:[e.jsx(i,{className:"w-4 h-4 mr-1"}),n.text]})}function Ta({statusCounts:t,totalCount:r,className:a="",interactive:s=!1,onStatusClick:n}){const{t:i}=h(),l=d=>{const o=t[d],{icon:m,color:g}=he[d];return e.jsxs("div",{className:`inline-flex items-center px-2.5 py-1 rounded-full ${o>0?`${g.background} ${g.text}`:"bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500 opacity-50"} ${s&&o>0?"cursor-pointer hover:opacity-80":""}`,onClick:()=>s&&o>0&&(n==null?void 0:n(d)),children:[e.jsx(ot,{status:d,className:"!bg-transparent !p-0"}),e.jsxs("span",{className:`ml-1 rounded-full px-1.5 py-0.5 text-xs font-medium ${o>0?`${g.background} ${g.text}`:"bg-gray-200 dark:bg-gray-600 text-gray-500 dark:text-gray-400"}`,children:[o,i("battery.list.unit")]})]})};return e.jsxs("div",{className:`flex flex-wrap gap-2 ${a}`,children:[e.jsx("div",{className:"flex justify-between text-xs text-gray-500 mb-2 w-full",children:e.jsxs("span",{children:[i("battery.list.batteryStatus")," (",i("battery.list.total",{count:r}),")"]})}),Object.keys(he).map(d=>l(d))]})}function Ra(t){return t.batteries?t.batteries.reduce((r,a)=>{const s=a.status;return r[s]++,r},{charged:0,in_use:0,empty:0,disposed:0}):{charged:0,in_use:0,empty:0,disposed:0}}function Pa(t){if(!t.batteries)return[];const r={};return t.batteries.filter(a=>a.device_id&&a.devices).forEach(a=>{var i;const s=a.device_id,n=((i=a.devices)==null?void 0:i.name)||"";r[s]||(r[s]={deviceName:n,batteryCount:0}),r[s].batteryCount++}),Object.entries(r).map(([a,s])=>({deviceId:a,deviceName:s.deviceName,batteryCount:s.batteryCount}))}function Fa({group:t}){const{t:r}=h(),a=M(),[s,n]=u.useState(null),[i,l]=u.useState({charged:0,in_use:0,empty:0,disposed:0}),[d,o]=u.useState([]),m=t.count;return t.id.slice(0,8),u.useEffect(()=>{dt(t.shape||t.type,t.image_url).then(c=>n(c));const g=Ra(t);l(g);const b=Pa(t);o(b)},[t]),e.jsx(T,{to:`/batteries/${t.id}`,className:"block bg-white dark:bg-dark-card border border-gray-100 dark:border-dark-border rounded-xl shadow-sm hover:shadow-md hover:border-gray-200 dark:hover:border-gray-600 hover:scale-[1.01] transition-all duration-200",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex flex-wrap items-center justify-between mb-4 gap-2",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-dark-text max-w-[70%] truncate",children:t.name}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-md bg-gray-50 dark:bg-gray-800 text-xs font-medium text-gray-600 dark:text-gray-300",children:r(ee(t.shape))}),e.jsx("span",{className:`inline-flex items-center px-2.5 py-1 rounded-md text-xs font-medium ${t.kind==="rechargeable"?"bg-green-50 dark:bg-green-900/20 text-green-700 dark:text-green-400":"bg-amber-50 dark:bg-amber-900/20 text-amber-700 dark:text-amber-400"}`,children:t.kind==="rechargeable"?r("battery.kind.rechargeable"):r("battery.kind.disposable")})]})]}),t.notes&&e.jsxs("div",{className:"mt-1.5 flex items-start",children:[e.jsx(Oe,{className:"h-3.5 w-3.5 text-gray-400 dark:text-gray-500 mt-0.5 mr-1.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 line-clamp-2",children:t.notes})]})]})}),e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"flex-shrink-0 mr-4",children:e.jsx("img",{src:s||"",alt:r("battery.image.alt",{type:t.shape||t.type}),className:"w-20 h-20 rounded-lg object-cover shadow-sm"})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(Ta,{statusCounts:i,totalCount:m,interactive:!1})})]}),e.jsx("div",{children:d.length>0&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-gray-100 dark:border-dark-border",children:[e.jsxs("p",{className:"text-xs font-medium text-gray-600 dark:text-gray-300 flex items-center",children:[e.jsx(ae,{className:"h-3 w-3 mr-1.5"}),r("battery.list.installedDevices")]}),e.jsx("div",{className:"mt-1.5 flex flex-wrap gap-1.5",children:d.map(g=>e.jsxs("button",{className:"inline-flex items-center px-2.5 py-1 rounded-full bg-blue-50 dark:bg-blue-900/20 text-xs text-blue-700 dark:text-blue-400 hover:bg-blue-100 dark:hover:bg-blue-900/30 transition-colors",onClick:b=>{b.stopPropagation(),a(`/devices/${g.deviceId}`)},children:[e.jsx("span",{className:"max-w-[120px] truncate",children:g.deviceName}),e.jsxs("span",{className:"ml-1 bg-blue-200 dark:bg-blue-900/40 text-blue-800 dark:text-blue-300 rounded-full px-1.5 py-0.5 text-xs font-medium",children:[g.batteryCount,r("battery.list.unit")]})]},g.deviceId))})]})})]})})})}const Aa=["すべて","単1形","単2形","単3形","単4形","9V形"],Ga=["すべて","disposable","rechargeable"],$a=["登録日（新しい順）","登録日（古い順）","名前（昇順）","名前（降順）"],De=ie((t,r)=>({selectedShape:"すべて",selectedKind:"すべて",searchTerm:"",sortOption:"登録日（新しい順）",showFilters:!1,setSelectedShape:a=>t({selectedShape:a}),setSelectedKind:a=>t({selectedKind:a}),setSearchTerm:a=>t({searchTerm:a}),setSortOption:a=>t({sortOption:a}),setShowFilters:a=>t({showFilters:a}),resetFilters:()=>t({selectedShape:"すべて",selectedKind:"すべて",searchTerm:""}),getFilteredAndSortedGroups:a=>{const{selectedShape:s,selectedKind:n,searchTerm:i,sortOption:l}=r();return a.filter(d=>{const o=s==="すべて"||d.shape===s||d.type===s,m=n==="すべて"||d.kind===n,g=i===""||d.name.toLowerCase().includes(i.toLowerCase())||d.notes&&d.notes.toLowerCase().includes(i.toLowerCase());return o&&m&&g}).sort((d,o)=>{switch(l){case"登録日（新しい順）":return new Date(o.created_at).getTime()-new Date(d.created_at).getTime();case"登録日（古い順）":return new Date(d.created_at).getTime()-new Date(o.created_at).getTime();case"名前（昇順）":return d.name.localeCompare(o.name);case"名前（降順）":return o.name.localeCompare(d.name);default:return 0}})}})),Ma={すべて:null,disposable:null,rechargeable:e.jsx(He,{className:"h-3 w-3 mr-1"})};function Ua(){const{t}=h(),r={すべて:t("common.all"),disposable:t("battery.kind.disposable"),rechargeable:t("battery.kind.rechargeable")},{selectedShape:a,selectedKind:s,searchTerm:n,sortOption:i,showFilters:l,setSelectedShape:d,setSelectedKind:o,setSearchTerm:m,setSortOption:g,setShowFilters:b,resetFilters:c,getFilteredAndSortedGroups:v}=De();return l?e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card p-5 rounded-xl shadow-sm border border-gray-100 dark:border-dark-border mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ke,{className:"h-4 w-4 text-gray-400"})}),e.jsx("input",{type:"text",placeholder:t("battery.list.searchPlaceholder"),value:n,onChange:p=>m(p.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text"})]}),e.jsxs("div",{className:"relative",children:[e.jsx("select",{value:i,onChange:p=>g(p.target.value),className:"block w-full pl-3 pr-10 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text focus:outline-none focus:ring-blue-500 focus:border-blue-500 appearance-none",children:$a.map(p=>e.jsx("option",{value:p,children:p},p))}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx(qe,{className:"h-4 w-4 text-gray-400"})})]})]}),e.jsx("div",{className:"bg-white dark:bg-dark-card p-5 rounded-xl shadow-sm border border-gray-100 dark:border-dark-border",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(U,{className:"h-4 w-4 mr-1.5 text-gray-500"}),t("battery.list.batteryType")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Aa.map(p=>e.jsx("button",{onClick:()=>d(p),className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${a===p?"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300 ring-1 ring-blue-300 dark:ring-blue-700":"bg-gray-50 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:p},p))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-3 flex items-center",children:[e.jsx(He,{className:"h-4 w-4 mr-1.5 text-gray-500 dark:text-gray-400"}),t("device.select.batteryType")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Ga.map(p=>e.jsxs("button",{onClick:()=>o(p),className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium transition-colors ${s===p?p==="rechargeable"?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300 ring-1 ring-green-300 dark:ring-green-700":p==="disposable"?"bg-amber-100 dark:bg-amber-900/20 text-amber-800 dark:text-amber-300 ring-1 ring-amber-300 dark:ring-amber-700":"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300 ring-1 ring-blue-300 dark:ring-blue-700":"bg-gray-50 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700"}`,children:[Ma[p],r[p]]},p))})]})]})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:c,className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300",children:t("device.select.reset")})})]}):null}function Oa(){const{t}=h(),{selectedShape:r,selectedKind:a,searchTerm:s,showFilters:n,setShowFilters:i}=De();return e.jsxs("button",{onClick:()=>i(!n),className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-dark-card hover:bg-gray-50 dark:hover:bg-gray-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(ne,{className:"h-4 w-4 mr-2 text-gray-500 dark:text-gray-400"}),t("battery.list.filter"),(r!=="すべて"||a!=="すべて"||s!=="")&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300",children:[r!=="すべて"?1:0,a!=="すべて"?1:0,s!==""?1:0].reduce((l,d)=>l+d,0)})]})}function Ka(){const{t}=h(),{batteryGroups:r,loading:a}=st();We.useMediaQuery({minWidth:768});const{getFilteredAndSortedGroups:s}=De(),n=s(r);return a?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-dark-text",children:t("battery.list.title")}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsx(Oa,{}),e.jsx(qa,{batteryGroups:r})]})]}),e.jsx(Ha,{batteryGroups:r}),e.jsx(Ua,{})]}),e.jsx("div",{className:"bg-white dark:bg-dark-card shadow rounded-xl overflow-hidden",children:n.length===0?e.jsxs("div",{className:"text-center py-16",children:[e.jsx(U,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-dark-text",children:r.length===0?t("battery.list.noBatteries"):t("battery.list.noMatchingBatteries")}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:r.length===0?t("battery.list.emptyStateMessage"):t("battery.list.noMatchingMessage")}),r.length===0&&e.jsx("div",{className:"mt-6",children:e.jsxs(T,{to:"/batteries/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),t("battery.list.addNew")]})})]}):e.jsx("div",{className:"p-4 sm:p-6",children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-6",children:n.map(i=>e.jsx(Fa,{group:i},i.id))})})})]})}function qa({batteryGroups:t}){const{t:r}=h(),{isLimitReached:a}=X();return a.batteryGroups(t.length)?e.jsx("div",{className:"relative inline-block",children:e.jsxs("button",{disabled:!0,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-400 cursor-not-allowed",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),r("battery.list.addNew")]})}):e.jsxs(T,{to:"/batteries/new",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),r("battery.list.addNew")]})}function Ha({batteryGroups:t}){const{t:r}=h(),{userPlan:a,loading:s}=X(),n=M();if(s||!a)return null;const i=t.length,d=at(a).batteryGroups,o=i>=d;return a.plan_type==="free"?r("plan.free"):a.plan_type==="standard"?r("plan.standard"):r("plan.pro"),e.jsx("div",{className:`p-4 rounded-lg mb-4 ${o?"bg-amber-50 dark:bg-amber-900/20":"bg-blue-50 dark:bg-blue-900/20"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[o&&e.jsx(Ve,{className:"h-5 w-5 text-amber-500 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsxs("p",{className:`text-sm mt-1 ${o?"text-amber-600 dark:text-amber-400":"text-blue-600 dark:text-blue-400"}`,children:[r("battery.list.groupCount",{current:i,max:d}),o&&` ${r("battery.list.limitReachedSettings")}`]})})]}),o&&e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>n("/settings"),children:r("battery.list.changeInSettings")})]})})}function Ce({isOpen:t,onClose:r,onConfirm:a,title:s,message:n,loading:i=!1,confirmText:l,cancelText:d}){const{t:o}=h();return t?(l=l||o("common.delete"),d=d||o("common.cancel"),e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:r}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsx("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:e.jsx("button",{type:"button",className:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",onClick:r,children:e.jsx(H,{className:"h-6 w-6"})})}),e.jsx("div",{className:"sm:flex sm:items-start",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left w-full",children:[e.jsx("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:s}),e.jsx("div",{className:"mt-2",children:e.jsx("p",{className:"text-sm text-gray-500 whitespace-pre-wrap",children:n})})]})}),e.jsxs("div",{className:"mt-5 sm:mt-4 sm:flex sm:flex-row-reverse",children:[e.jsx("button",{type:"button",className:"w-full inline-flex justify-center rounded-md border border-transparent shadow-sm px-4 py-2 bg-red-600 text-base font-medium text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 sm:ml-3 sm:w-auto sm:text-sm disabled:opacity-50",onClick:a,disabled:i,children:i?o("common.loading"):l}),e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 shadow-sm px-4 py-2 bg-white text-base font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:w-auto sm:text-sm",onClick:r,disabled:i,children:d})]})]})]})})):null}async function Wa(t){const{data:r,error:a}=await j.from("battery_usage_history").select(`
      *,
      devices (*)
    `).eq("battery_id",t).order("started_at",{ascending:!1});if(a)throw a;return r}async function Va(t){const{data:r,error:a}=await j.from("battery_usage_history").select(`
      *,
      batteries (
        *,
        battery_groups (*)
      )
    `).eq("device_id",t).order("started_at",{ascending:!1});if(a)throw a;return r}async function za(t){const{data:r,error:a}=await j.from("battery_usage_history").insert(t).select();if(a)throw a;return r}async function Qa(t){const r=new Date().toISOString(),{data:a}=await j.from("battery_usage_history").select("id").eq("device_id",t).is("ended_at",null);if(a&&a.length>0){const{error:s}=await j.from("battery_usage_history").update({ended_at:r}).in("id",a.map(n=>n.id));if(s)throw s}return!0}async function Ya(t,r,a){const s=new Date().toISOString();try{if(await Qa(t),await da(t),r.length>0){await la(t),await ha(r,{device_id:t,status:"in_use",last_checked:s,last_changed_at:s});const n=r.map(i=>({battery_id:i,device_id:t,started_at:s,user_id:a}));await za(n)}return!0}catch(n){throw console.error("Error assigning batteries to device:",n),n}}async function Ja(t,r,a,s){try{const{data:n,error:i}=await j.from("battery_groups").insert(t).select().single();if(i)throw i;const l=Array.from({length:r},()=>({group_id:n.id,status:t.kind==="disposable"?"empty":a,user_id:s})),{error:d}=await j.from("batteries").insert(l);if(d)throw d;return n}catch(n){throw console.error("Error creating battery group with batteries:",n),n}}const Za={maxSizeMB:.03,maxWidthOrHeight:100,useWebWorker:!0};async function ct(t,r){var a;try{re(t);const s={...Za,...r},n=t instanceof File?t:new File([t],"image.jpg",{type:t.type}),i=await Bt(n,s),l=t instanceof File?t.name:"cropped_image.jpg",d=((a=l.split(".").pop())==null?void 0:a.toLowerCase())||"",o=`${l.replace(`.${d}`,"")}_compressed.${d}`;return new File([i],o,{type:i.type})}catch(s){throw s instanceof Error?s:new Error("画像の圧縮に失敗しました")}}function re(t){const r=["image/jpeg","image/jpg","image/png","image/webp"];if(!t.type||!r.includes(t.type))throw new Error("JPG、PNG、WebP形式の画像のみアップロードできます");const a=5*1024*1024;if(t.size>a)throw new Error("ファイルサイズは5MB以下にしてください");if(t.size<1024)throw new Error("ファイルサイズが小さすぎます")}async function mt(t,r,a,s=null){try{const n=await ct(a,{maxSizeMB:.05,maxWidthOrHeight:200}),i=n.name.split(".").pop(),l=`${t}/${r}/image.${i}`;if(s){const m=s.split("/").slice(-3).join("/");await j.storage.from("battery-images").remove([m])}const{error:d}=await j.storage.from("battery-images").upload(l,n,{upsert:!0});if(d)throw d;const{error:o}=await j.from("battery_groups").update({image_url:l}).eq("id",r);if(o)throw o;return l}catch(n){throw console.error("画像アップロード処理エラー:",n),n}}async function ut(t,r,a,s=null){try{const n=await ct(a,{maxSizeMB:.05,maxWidthOrHeight:200}),i=n.name.split(".").pop(),l=`${t}/${r}/image.${i}`;if(s){const m=s.split("/").slice(-3).join("/");await j.storage.from("device-images").remove([m])}const{error:d}=await j.storage.from("device-images").upload(l,n,{upsert:!0});if(d)throw d;const{error:o}=await j.from("devices").update({image_url:l}).eq("id",r);if(o)throw o;return l}catch(n){throw console.error("画像アップロード処理エラー:",n),n}}const N=ie((t,r)=>({batteryGroup:null,batteries:[],isEditing:!1,editData:null,imageUrl:null,error:null,saving:!1,deleting:!1,showDeleteConfirm:!1,get installedCount(){return r().batteries.filter(a=>a.device_id!==null&&a.device_id!==void 0).length},restrictTypeAndCountEditing:!1,removeBatteryFromDevice:async a=>{try{const s=new Date().toISOString(),n=await pa(a);if(n){const{batteries:i}=r(),l=i.map(d=>d.id===a?{...d,device_id:null,status:"empty",last_changed_at:s,devices:null}:d);t({batteries:l})}return n}catch(s){throw console.error("電池取り外しエラー:",s),s}},setIsEditing:a=>t({isEditing:a}),setEditData:a=>t(s=>({editData:s.editData?{...s.editData,...a}:null})),setError:a=>t({error:a}),setImageUrl:a=>t({imageUrl:a}),setSaving:a=>t({saving:a}),setDeleting:a=>t({deleting:a}),setShowDeleteConfirm:a=>t({showDeleteConfirm:a}),setBatteryGroup:a=>t({batteryGroup:a}),setBatteries:a=>{console.log("setBatteries");const s=a.filter(n=>n.device_id!==null&&n.device_id!==void 0).length;console.log(s),t({batteries:a,restrictTypeAndCountEditing:s>0})},initializeEditData:a=>t({editData:{name:a.name,shape:a.shape||a.type,kind:a.kind,count:a.count,voltage:a.voltage,notes:a.notes??""}}),resetEditData:()=>{const{batteryGroup:a}=r();a&&t({editData:{name:a.name,shape:a.shape||a.type,kind:a.kind,count:a.count,voltage:a.voltage,notes:a.notes??""},isEditing:!1})},handleSave:async a=>{const{batteryGroup:s,editData:n,batteries:i}=r();if(!(!s||!n)){t({saving:!0,error:null});try{const l=await Je();if(!l)throw new Error("ユーザー情報が取得できませんでした");const d=s.count,o=n.count,m=i.filter(g=>g.device_id!==null&&g.device_id!==void 0).length;if(o<d&&m>0)throw new Error("デバイスに設定されている電池があるため、本数を減らすことはできません");if(await ma(s.id,{name:n.name,shape:n.shape,kind:n.kind,count:n.count,voltage:n.voltage,notes:n.notes||null}),o>d){const g=Array.from({length:o-d},()=>({group_id:s.id,status:s.kind==="rechargeable"?"charged":"empty",user_id:l.id}));await xa(g)}if(t({isEditing:!1,saving:!1}),a){const{invalidateBatteries:g}=Se(a);await g()}}catch(l){t({error:l instanceof Error?l.message:"保存に失敗しました",saving:!1})}}},handleDelete:async()=>{const{batteryGroup:a}=r();if(a){t({deleting:!0,error:null});try{await ua(a.id),window.location.href="/batteries"}catch(s){t({error:s instanceof Error?s.message:"削除に失敗しました",deleting:!1,showDeleteConfirm:!1})}}},handleCancelEdit:()=>{r().resetEditData()}}));function Xa({title:t,aria_label:r,placeholder:a,isEditing:s,setEditData:n}){const i="text-lg font-medium text-gray-900 dark:text-dark-text  w-full truncate";return s?e.jsx("input",{type:"text",value:t,onChange:l=>n({name:l.target.value}),className:"border-b-2 border-blue-500 focus:outline-none bg-transparent dark:text-gray-300"+i,"aria-label":r,placeholder:a}):e.jsx("h2",{className:i,children:t})}function gt(t){const{t:r}=h();return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center mb-4 sm:mb-0",children:[e.jsx(t.icon,{className:"h-6 w-6 text-gray-400 dark:text-gray-500 mr-3 flex-shrink-0"}),e.jsx("div",{className:"min-w-0 flex-1",children:e.jsx(Xa,{title:t.title,aria_label:t.title_label,placeholder:t.title_placeholder,isEditing:t.isEditing,setEditData:t.setEditData})})]}),e.jsxs("div",{className:"flex items-center justify-between sm:justify-end w-full sm:w-auto",children:[e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400 mr-4",children:r("common.registrationDate",{date:t.created_at})}),t.isEditing?e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:t.onClickCancelEdit,className:"inline-flex items-center p-2 border border-transparent rounded-full text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsx("button",{onClick:t.onClickSave,disabled:t.saving,className:"inline-flex items-center p-2 border border-transparent rounded-full text-green-600 dark:text-green-500 hover:text-green-700 dark:hover:text-green-400 disabled:opacity-50",children:e.jsx(ze,{className:"h-5 w-5"})})]}):e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:t.onClickEdit,className:"inline-flex items-center p-2 border border-transparent rounded-full text-gray-400 dark:text-gray-500 hover:text-gray-500 dark:hover:text-gray-300",children:e.jsx(le,{className:"h-5 w-5"})}),e.jsx("button",{onClick:t.onClickDelete,disabled:t.installedCount>0,title:t.installedCount>0?t.cannotDelete:t.deleteGroup,className:"inline-flex items-center p-2 border border-transparent rounded-full text-gray-400 dark:text-gray-500 hover:text-red-500 dark:hover:text-red-400 disabled:opacity-50 disabled:hover:text-gray-400 dark:disabled:hover:text-gray-500",children:e.jsx(Lt,{className:"h-5 w-5"})})]})]})]})}function er(){const{t}=h(),r=be(),a=N(c=>c.isEditing),s=N(c=>c.editData),n=N(c=>c.setEditData),i=N(c=>c.batteryGroup),l=N(c=>c.installedCount),d=N(c=>c.handleSave),o=N(c=>c.handleCancelEdit),m=N(c=>c.setIsEditing),g=N(c=>c.setShowDeleteConfirm),b=N(c=>c.saving);return!s||!i?null:e.jsx(gt,{icon:U,title:s.name,title_label:t("battery.detail.titleLabel"),title_placeholder:t("battery.detail.titlePlaceholder"),cannotDelete:t("battery.detail.cannotDelete"),deleteGroup:t("battery.list.deleteGroup"),created_at:new Date(i.created_at).toLocaleDateString(),installedCount:l,saving:b,isEditing:a,setEditData:n,onClickCancelEdit:o,onClickSave:()=>d(r),onClickDelete:()=>g(!0),onClickEdit:()=>m(!0)})}function de({image:t,onClose:r,onCropComplete:a}){const[s,n]=u.useState({x:0,y:0}),[i,l]=u.useState(1),[d,o]=u.useState(null),[m,g]=u.useState(!1),b=w=>{n(w)},c=w=>{l(w)},v=u.useCallback((w,f)=>{o(f)},[]),p=w=>new Promise((f,C)=>{const D=new Image;D.addEventListener("load",()=>f(D)),D.addEventListener("error",B=>C(B)),D.src=w}),L=async(w,f)=>{const C=await p(w),D=document.createElement("canvas"),B=D.getContext("2d");if(!B)throw new Error("No 2d context");const y=Math.min(f.width,f.height);return D.width=y,D.height=y,B.drawImage(C,f.x,f.y,y,y,0,0,y,y),new Promise((I,x)=>{D.toBlob(k=>{k?I(k):x(new Error("Canvas is empty"))},"image/jpeg",.95)})},_=async()=>{if(!(m||!d))try{g(!0);const w=await L(t,d);await a(w)}catch(w){console.error("画像の切り抜きに失敗しました:",w)}finally{g(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto bg-black bg-opacity-75",children:e.jsx("div",{className:"flex min-h-screen items-center justify-center px-4 pt-4 pb-20 text-center",children:e.jsxs("div",{className:"relative w-full max-w-3xl",children:[e.jsx("button",{onClick:r,className:"absolute right-0 top-0 m-4 p-2 text-white hover:text-gray-300 z-10",children:e.jsx(H,{className:"h-6 w-6"})}),e.jsx("div",{className:"relative h-96 w-full",children:e.jsx(It,{image:t,crop:s,zoom:i,aspect:1,onCropChange:b,onZoomChange:c,onCropComplete:v})}),e.jsxs("div",{className:"mt-4 flex items-center justify-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("label",{htmlFor:"zoom",className:"mr-2 text-white",children:"拡大"}),e.jsx("input",{type:"range",id:"zoom",min:1,max:3,step:.1,value:i,onChange:w=>c(Number(w.target.value)),className:"w-32"})]}),e.jsx("button",{onClick:_,disabled:m,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"処理中...":"切り抜く"})]})]})})})}function xt({imageUrl:t,alt:r,onClose:a}){return e.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-75 flex items-center justify-center p-4",onClick:a,children:e.jsxs("div",{className:"relative max-w-full max-h-full",onClick:s=>s.stopPropagation(),children:[e.jsx("button",{onClick:a,className:"absolute right-0 top-0 m-4 p-2 text-white hover:text-gray-300 z-10",children:e.jsx(H,{className:"h-6 w-6"})}),e.jsx("img",{src:t,alt:r,className:"max-w-full max-h-screen object-contain rounded-lg"})]})})}function tr({imageUrl:t,batteryGroup:r,setError:a}){const{t:s}=h(),{user:n}=K(),i=u.useRef(null),[l,d]=u.useState(!1),[o,m]=u.useState(null),[g,b]=u.useState(!1),{isEditing:c}=N(),v=async _=>{var f;const w=(f=_.target.files)==null?void 0:f[0];if(!(!w||!n))try{re(w);const C=new FileReader;C.onloadend=()=>{m(C.result),d(!0)},C.readAsDataURL(w)}catch(C){console.error(s("battery.detail.imageSelectError"),C),a(C instanceof Error?C.message:s("battery.detail.imageSelectFailed"))}},p=async _=>{if(n)try{await mt(n.id,r.id,_,r.image_url||null),d(!1),m(null),window.location.reload()}catch(w){console.error(s("battery.detail.imageUploadError"),w),a(w instanceof Error?w.message:s("battery.detail.imageUploadFailed"))}},L=()=>{var _;c?(_=i.current)==null||_.click():t&&b(!0)};return e.jsxs("div",{className:"flex-shrink-0",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:t||"",alt:s("battery.detail.imageAlt",{type:r.type}),className:"w-32 h-32 rounded-lg object-cover border border-gray-200 dark:border-gray-700 cursor-pointer",onClick:L}),c&&e.jsx("button",{onClick:()=>{var _;return(_=i.current)==null?void 0:_.click()},className:"absolute inset-0 flex items-center justify-center bg-black dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-70 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg",children:e.jsx(J,{className:"h-6 w-6 text-white dark:text-gray-300"})}),e.jsx("input",{ref:i,type:"file",accept:"image/*",className:"hidden",onChange:v})]}),l&&o&&e.jsx(de,{image:o,onClose:()=>{d(!1),m(null)},onCropComplete:p}),g&&t&&e.jsx(xt,{imageUrl:t,alt:s("battery.detail.imageAlt",{type:r.type}),onClose:()=>b(!1)})]})}function W({title:t}){return e.jsx("dt",{className:"text-xs font-medium text-gray-500 uppercase tracking-wider mb-1",children:t})}function oe({title:t,value:r,isEditing:a,children:s}){return e.jsxs("div",{children:[e.jsx(W,{title:t}),e.jsx("dd",{className:"mt-1",children:a?s:e.jsx("div",{children:e.jsx("span",{className:"text-sm text-gray-900 dark:text-dark-text",children:r})})})]})}function ht({value:t,onChange:r,disabled:a=!1,className:s="",restrictionMessage:n}){const{t:i}=h();return e.jsxs("div",{children:[e.jsx("select",{value:t,onChange:l=>r(l.target.value),disabled:a,className:`block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text ${a?"bg-gray-100 dark:bg-gray-700 cursor-not-allowed":""} ${s}`,children:La.map(l=>e.jsx("option",{value:l.value,children:i(l.labelKey)},l.value))}),a&&n&&e.jsx("p",{className:"mt-1 text-xs text-amber-600 dark:text-amber-400",children:n})]})}function ar(){const{t}=h(),r=N(l=>l.isEditing),a=N(l=>l.editData),s=N(l=>l.setEditData),n=N(l=>l.restrictTypeAndCountEditing),i=N(l=>l.batteryGroup);return!a||!i?null:e.jsx(oe,{title:t("battery.detail.shape"),value:t(ee(i.shape)),isEditing:r,children:e.jsx(ht,{value:a.shape,onChange:l=>s({shape:l}),disabled:n,restrictionMessage:n?t("battery.detail.cannotChangeShape"):void 0})})}function rr(){const{t}=h(),r=N(l=>l.isEditing),a=N(l=>l.editData),s=N(l=>l.setEditData),n=N(l=>l.restrictTypeAndCountEditing),i=N(l=>l.batteryGroup);return!a||!i?null:e.jsx(oe,{title:t("battery.detail.kind"),value:i.kind==="rechargeable"?t("battery.kind.rechargeable"):t("battery.kind.disposable"),isEditing:r,children:e.jsxs("div",{children:[e.jsxs("select",{value:a.kind,onChange:l=>s({kind:l.target.value}),disabled:n,className:`block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text ${n?"bg-gray-100 dark:bg-gray-700 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"rechargeable",children:t("battery.kind.rechargeable")}),e.jsx("option",{value:"disposable",children:t("battery.kind.disposable")})]}),n&&e.jsx("p",{className:"mt-1 text-xs text-amber-600 dark:text-amber-400",children:t("battery.detail.cannotChangeKind")})]})})}function sr(){const{t}=h(),r=N(d=>d.isEditing),a=N(d=>d.editData),s=N(d=>d.setEditData),n=N(d=>d.restrictTypeAndCountEditing),i=N(d=>d.batteryGroup),l=N(d=>d.installedCount);return!a||!i?null:e.jsx(oe,{title:t("battery.detail.count"),value:i.count+t("common.unit"),isEditing:r,children:e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"1",value:a.count,onChange:d=>s({count:parseInt(d.target.value)}),disabled:n,className:`block w-full border rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text ${n?"bg-gray-100 dark:bg-gray-700 cursor-not-allowed border-gray-300 dark:border-gray-600":a.count<i.count&&l>0?"border-red-300 dark:border-red-700":"border-gray-300 dark:border-gray-600"}`}),n?e.jsx("p",{className:"mt-1 text-xs text-amber-600 dark:text-amber-400",children:t("battery.detail.cannotChangeCount")}):a.count<i.count&&l>0&&e.jsx("p",{className:"mt-1 text-sm text-red-600 dark:text-red-400",children:t("battery.detail.cannotReduceCount")})]})})}function nr(){const{t}=h(),r=N(i=>i.isEditing),a=N(i=>i.editData),s=N(i=>i.setEditData),n=N(i=>i.batteryGroup);return!a||!n?null:e.jsx(oe,{title:t("battery.voltage"),value:`${n.voltage}V`,isEditing:r,children:e.jsx("input",{type:"number",step:"0.1",value:a.voltage,onChange:i=>s({voltage:parseFloat(i.target.value)}),className:"block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text"})})}function ir(){const{t}=h(),r=N(i=>i.isEditing),a=N(i=>i.editData),s=N(i=>i.setEditData),n=N(i=>i.batteryGroup);return!a||!n?null:e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(W,{title:t("battery.detail.memo")}),e.jsx("dd",{className:"mt-1",children:r?e.jsx("textarea",{rows:3,value:a.notes,onChange:i=>s({notes:i.target.value}),className:"block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text",placeholder:t("battery.detail.memoPlaceholder")}):e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 p-3 rounded-md text-gray-900 dark:text-dark-text whitespace-pre-wrap",children:n.notes||"---"})})]})}function ce({header:t,children:r}){return e.jsxs("div",{className:"bg-white dark:bg-dark-card shadow rounded-lg overflow-hidden mb-6",children:[e.jsx("div",{className:"px-4 py-5 sm:px-6 bg-gray-50 border-b border-gray-200 dark:bg-gray-800 dark:border-dark-border",children:t}),e.jsx("div",{className:"px-4 py-4 sm:px-6 border-b border-gray-200 dark:border-dark-border",children:r})]})}function lr({}){const{setError:t,imageUrl:r,batteryGroup:a}=N();return e.jsx(ce,{header:e.jsx(er,{}),children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex space-x-6",children:[a&&e.jsx(tr,{imageUrl:r,batteryGroup:{id:a.id,type:a.type,image_url:a.image_url},setError:t}),e.jsx("div",{className:"flex-1",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 lg:grid-cols-3 sm:grid-cols-2",children:[e.jsx(ar,{}),e.jsx(rr,{}),e.jsx(sr,{}),e.jsx(nr,{})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(ir,{})})]})})}function dr({isOpen:t,onClose:r,batteryId:a,batteryName:s}){const{data:n,isLoading:i}=O({queryKey:["batteryUsageHistory",a],queryFn:async()=>await Wa(a),enabled:t});return t?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 transition-opacity",onClick:r}),e.jsxs("div",{className:"inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsx("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:e.jsx("button",{type:"button",className:"bg-white rounded-md text-gray-400 hover:text-gray-500 focus:outline-none",onClick:r,children:e.jsx(H,{className:"h-6 w-6"})})}),e.jsx("div",{className:"sm:flex sm:items-start",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left w-full",children:[e.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900",children:[s,"の使用履歴"]}),i?e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):n&&n.length>0?e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"flow-root",children:e.jsx("ul",{className:"-mb-8",children:n.map((l,d)=>e.jsx("li",{children:e.jsxs("div",{className:"relative pb-8",children:[d!==n.length-1?e.jsx("span",{className:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"}):null,e.jsxs("div",{className:"relative flex space-x-3",children:[e.jsx("div",{children:e.jsx("span",{className:"h-8 w-8 rounded-full bg-blue-100 flex items-center justify-center ring-8 ring-white",children:e.jsx(Tt,{className:"h-5 w-5 text-blue-600"})})}),e.jsx("div",{className:"min-w-0 flex-1 pt-1.5 flex justify-between space-x-4",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500",children:[l.devices.name,"で使用"]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500",children:[new Date(l.started_at).toLocaleString(),l.ended_at&&e.jsxs(e.Fragment,{children:[" → ",new Date(l.ended_at).toLocaleString()]})]})]})})]})]})},l.id))})})}):e.jsx("p",{className:"mt-4 text-sm text-gray-500",children:"使用履歴はありません"})]})})]})]})}):null}const xe={charged:"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-300 border-green-200 dark:border-green-800",in_use:"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300 border-blue-200 dark:border-blue-800",empty:"bg-yellow-100 dark:bg-yellow-900/20 text-yellow-800 dark:text-yellow-300 border-yellow-200 dark:border-yellow-800",disposed:"bg-red-100 dark:bg-red-900/20 text-red-800 dark:text-red-300 border-red-200 dark:border-red-800"},or={charged:"text-green-500",in_use:"text-blue-500",empty:"text-yellow-500",disposed:"text-red-500"};function cr({battery:t,batteryGroup:r,setError:a}){var w;const{t:s}=h(),[n,i]=u.useState(!1),[l,d]=u.useState(!1),[o,m]=u.useState(!1),[g,b]=u.useState(!1),{user:c}=K(),v=N(f=>f.removeBatteryFromDevice),p=async()=>{if(t.device_id)try{b(!0),await v(t.id),m(!1),window.location.reload()}catch(f){a(f instanceof Error?f.message:s("battery.detail.item.removeError"))}finally{b(!1)}},L=async(f,C)=>{if(c&&!(r.kind==="disposable"&&C==="charged"))try{await ya(f,C),window.location.reload()}catch(D){a(D instanceof Error?D.message:s("battery.detail.item.updateStatusError"))}},_=()=>{const f=t.status,D=xe[f].match(/border-\w+-\d+/),B=D?D[0]:"border-gray-200",y=B.replace("border-","dark:border-");return`border-l-4 ${B} ${y}`};return e.jsxs("div",{className:`bg-white dark:bg-dark-card rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 ${_()} p-4 transition-all hover:shadow-md`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:`h-5 w-5 mr-2 ${or[t.status]}`}),e.jsxs("h4",{className:"text-base font-medium text-gray-900 dark:text-dark-text",children:["#",t.slot_number]})]}),e.jsx("div",{className:`px-2 py-1 rounded-full text-xs font-medium ${xe[t.status]}`,children:s(`battery.status.${t.status}`)}),e.jsx("button",{onClick:()=>d(!l),className:"inline-flex items-center px-2 py-1 text-xs font-medium rounded-md bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",children:s("battery.detail.item.changeStatus")})]}),e.jsx("div",{className:"mb-2",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 dark:text-gray-400 mr-2",children:[s("battery.detail.item.installationStatus"),":"]}),e.jsx("dd",{className:"text-sm flex-1 truncate max-w-[150px] flex items-center",children:t.device_id&&t.devices?e.jsx(e.Fragment,{children:e.jsx(T,{to:`/devices/${t.devices.id}`,className:"flex items-center text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-300 group",children:e.jsx("span",{className:"group-hover:underline truncate",children:t.devices.name})})}):e.jsx("span",{className:"text-gray-500 dark:text-gray-400",children:s("battery.detail.item.notInstalled")})})]})})}),l&&e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",onClick:()=>d(!1),children:e.jsxs("div",{className:"flex items-center justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 transition-opacity","aria-hidden":"true",children:e.jsx("div",{className:"absolute inset-0 bg-gray-500 dark:bg-gray-900 opacity-75"})}),e.jsxs("div",{className:"inline-block align-bottom bg-white dark:bg-dark-card rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full",onClick:f=>f.stopPropagation(),children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card px-4 pt-5 pb-4 sm:p-6 sm:pb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text mb-3",children:s("battery.detail.item.changeStatusTitle",{number:t.slot_number})}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:["charged","in_use","empty","disposed"].map(f=>{const C=r.kind==="disposable"&&f==="charged",D=t.status===f;return e.jsxs("button",{onClick:()=>{C||(L(t.id,f),d(!1))},disabled:C,className:`px-4 py-3 rounded-md text-sm font-medium flex items-center justify-center ${C?"bg-gray-100 dark:bg-gray-700 text-gray-400 dark:text-gray-500 cursor-not-allowed":D?xe[f]:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:[s(`battery.status.${f}`),D&&e.jsx(ze,{className:"h-4 w-4 ml-2"})]},f)})})]}),e.jsx("div",{className:"bg-gray-50 dark:bg-gray-800 px-4 py-3 sm:px-6 sm:flex sm:flex-row-reverse",children:e.jsx("button",{type:"button",className:"mt-3 w-full inline-flex justify-center rounded-md border border-gray-300 dark:border-gray-600 shadow-sm px-4 py-2 bg-white dark:bg-dark-card text-base font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 sm:mt-0 sm:ml-3 sm:w-auto sm:text-sm",onClick:()=>d(!1),children:s("common.cancel")})})]})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-3 pt-3 border-t border-gray-100 dark:border-gray-700 text-xs text-gray-500 dark:text-gray-400",children:[e.jsxs("div",{children:[e.jsxs("div",{children:[s("battery.detail.item.lastChecked"),": ",t.last_checked?new Date(t.last_checked).toLocaleDateString():"---"]}),e.jsxs("div",{children:[s("battery.detail.item.lastChanged"),": ",t.last_changed_at?new Date(t.last_changed_at).toLocaleDateString():"---"]})]}),t.device_id&&t.devices?e.jsx("button",{onClick:()=>m(!0),className:"ml-2 inline-flex items-center p-1 rounded-full text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20",title:s("battery.detail.item.removeFromDevice"),children:e.jsx(Rt,{className:"h-4 w-4"})}):e.jsx(e.Fragment,{}),e.jsx("button",{onClick:()=>i(!0),className:"inline-flex items-center p-1 rounded-full bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-400 hover:bg-gray-200 dark:hover:bg-gray-600",title:s("battery.detail.item.usageHistory"),children:e.jsx(ye,{className:"h-4 w-4"})})]}),e.jsx(dr,{isOpen:n,onClose:()=>i(!1),batteryId:t.id,batteryName:`${r.name} #${t.slot_number}`}),e.jsx(Ce,{isOpen:o,onClose:()=>m(!1),onConfirm:p,title:s("battery.detail.item.removeFromDevice"),message:s("battery.detail.item.removeConfirmMessage",{deviceName:(w=t.devices)==null?void 0:w.name}),confirmText:s("battery.detail.item.removeConfirm"),cancelText:s("common.cancel"),loading:g})]})}function mr({}){const{t}=h(),{setError:r,batteryGroup:a,batteries:s}=N(),n=s?[...s].sort((i,l)=>i.slot_number-l.slot_number):[];return e.jsx(ce,{header:e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text",children:t("battery.list.individualSettings")}),children:e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 gap-4",children:n.map(i=>a&&e.jsx(cr,{battery:i,batteryGroup:a,setError:r},i.slot_number))})})}function ur(){const{t}=h(),{id:r}=pe(),a=M(),{batteryGroup:s,batteries:n,loading:i}=Ca(r||""),{isEditing:l,setIsEditing:d,editData:o,initializeEditData:m,error:g,setError:b,imageUrl:c,setImageUrl:v,showDeleteConfirm:p,setShowDeleteConfirm:L,saving:_,deleting:w,handleSave:f,handleDelete:C,handleCancelEdit:D,batteryGroup:B,setBatteryGroup:y,batteries:I,setBatteries:x}=N();return u.useEffect(()=>{s&&!i&&(y(s),x(n))},[s,n,i,y,x]),u.useEffect(()=>{B&&!i&&(m(B),d(!1))},[B,i,m,d]),u.useEffect(()=>{B&&!i&&dt(B.shape||B.type,B.image_url).then(k=>v(k))},[B,i,v]),i||!s||!n||!B||!I||!o?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-bg flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-bg",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>a("/batteries"),className:"inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),t("battery.list.backToList")]})}),e.jsx(lr,{}),e.jsx(mr,{}),g&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:g})}),e.jsx(Ce,{isOpen:p,onClose:()=>L(!1),onConfirm:C,title:t("battery.list.deleteGroup"),message:t("battery.list.deleteConfirmation",{name:B.name}),loading:w})]})})}function gr({value:t,onChange:r,disabled:a=!1,className:s="",onRelatedStateChange:n}){const{t:i}=h(),l=d=>{a||(r(d),n&&n(d))};return e.jsx("div",{className:`grid grid-cols-2 gap-3 ${s}`,children:Ia.map(d=>e.jsx("div",{className:`relative flex cursor-pointer rounded-lg border p-4 focus:outline-none ${t===d.value?"border-blue-500 dark:border-blue-700 ring-2 ring-blue-500 dark:ring-blue-700 bg-white dark:bg-dark-card":"border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-card"} ${a?"opacity-50 cursor-not-allowed":""}`,onClick:()=>l(d.value),children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm",children:e.jsx("p",{className:"font-medium text-gray-900 dark:text-dark-text",children:i(d.labelKey)})})})})},d.value))})}function xr(){const{t}=h(),r=M(),{user:a}=K(),{batteryGroups:s}=st(),{isLimitReached:n}=X(),[i,l]=u.useState(!1),[d,o]=u.useState(null),[m,g]=u.useState(!1),b=n.batteryGroups(s.length);u.useEffect(()=>{b&&g(!0)},[b]);const[c,v]=u.useState({name:"",shape:"単3形",kind:"disposable",status:"charged",count:1,voltage:1.5,notes:""}),p=u.useRef(null),[L,_]=u.useState(null),[w,f]=u.useState(!1),[C,D]=u.useState(null),B=x=>{var P;const k=(P=x.target.files)==null?void 0:P[0];if(!(!k||!a))try{re(k);const F=new FileReader;F.onloadend=()=>{_(F.result),f(!0)},F.readAsDataURL(k)}catch(F){console.error(t("battery.detail.imageSelectError"),F),o(F instanceof Error?F.message:t("battery.detail.imageSelectFailed"))}},y=async x=>{D(x),f(!1),_(URL.createObjectURL(x))},I=async x=>{if(x.preventDefault(),!!a){if(b){o(t("battery.form.limitReachedError"));return}l(!0),o(null);try{const k=await Ja({name:c.name,shape:c.shape,kind:c.kind,count:c.count,voltage:c.voltage,notes:c.notes||null,user_id:a.id},c.count,c.status,a.id);if(C)try{await mt(a.id,k.id,C)}catch(P){console.error(t("battery.detail.imageUploadError"),P)}r("/batteries")}catch(k){o(k instanceof Error?k.message:t("battery.form.createError")),l(!1)}}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:[e.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>r("/batteries"),className:"inline-flex items-center text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),t("battery.list.backToList")]})}),e.jsxs("div",{className:"bg-white dark:bg-dark-card shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-5 sm:px-6 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(U,{className:"h-6 w-6 text-gray-400 dark:text-gray-500 mr-3"}),e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-dark-text",children:t("battery.form.title")})]})}),e.jsxs("form",{onSubmit:I,className:"px-4 py-5 sm:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("battery.form.imageLabel")}),L?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:L,alt:t("battery.detail.imageAlt",{type:c.shape}),className:"w-32 h-32 rounded-lg object-cover border border-gray-200 dark:border-gray-700"}),e.jsx("button",{type:"button",onClick:()=>{var x;return(x=p.current)==null?void 0:x.click()},className:"absolute inset-0 flex items-center justify-center bg-black dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-70 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg",children:e.jsx(J,{className:"h-6 w-6 text-white dark:text-gray-300"})})]}):e.jsxs("button",{type:"button",onClick:()=>{var x;return(x=p.current)==null?void 0:x.click()},className:"flex items-center justify-center w-32 h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-gray-400 dark:hover:border-gray-500 focus:outline-none",children:[e.jsx(J,{className:"h-6 w-6 text-gray-400 dark:text-gray-500 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t("battery.form.uploadImage")})]}),e.jsx("input",{ref:p,type:"file",accept:"image/*",className:"hidden",onChange:B}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t("battery.form.imageHelp")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("battery.form.nameLabel")}),e.jsx("input",{type:"text",id:"name",required:!0,value:c.name,onChange:x=>v({...c,name:x.target.value}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text",placeholder:t("battery.form.namePlaceholder")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"shape",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("battery.detail.shape")}),e.jsx(ht,{value:c.shape,onChange:x=>v({...c,shape:x})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("battery.detail.kind")}),e.jsx(gr,{value:c.kind,onChange:x=>v({...c,kind:x,status:x==="disposable"?"empty":c.status})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:t("battery.form.statusLabel")}),e.jsxs("div",{className:"mt-2 grid grid-cols-2 gap-3",children:[e.jsx("div",{className:`relative flex rounded-lg border p-4 ${c.status==="charged"?"border-blue-500 dark:border-blue-700 ring-2 ring-blue-500 dark:ring-blue-700 bg-white dark:bg-dark-card":"border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-card"} ${c.kind==="disposable"?"opacity-50 cursor-not-allowed":"cursor-pointer"}`,onClick:()=>{c.kind==="rechargeable"&&v({...c,status:"charged"})},children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm",children:e.jsx("p",{className:"font-medium text-gray-900 dark:text-dark-text",children:t("battery.status.charged")})})})})}),e.jsx("div",{className:`relative flex cursor-pointer rounded-lg border p-4 focus:outline-none ${c.status==="empty"?"border-blue-500 dark:border-blue-700 ring-2 ring-blue-500 dark:ring-blue-700 bg-white dark:bg-dark-card":"border-gray-300 dark:border-gray-600 bg-white dark:bg-dark-card"}`,onClick:()=>v({...c,status:"empty"}),children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"flex items-center",children:e.jsx("div",{className:"text-sm",children:e.jsx("p",{className:"font-medium text-gray-900 dark:text-dark-text",children:t("battery.status.empty")})})})})})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"count",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("battery.detail.count")}),e.jsx("input",{type:"number",id:"count",min:"1",value:c.count,onChange:x=>v({...c,count:parseInt(x.target.value)}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"voltage",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("battery.voltage")}),e.jsx("input",{type:"number",id:"voltage",step:"0.1",min:"0",value:c.voltage,onChange:x=>v({...c,voltage:parseFloat(x.target.value)}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("battery.detail.memo")}),e.jsx("textarea",{id:"notes",rows:3,value:c.notes,onChange:x=>v({...c,notes:x.target.value}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm bg-white dark:bg-dark-card text-gray-900 dark:text-dark-text"})]}),d&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800/30 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:d})}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:i,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:t(i?"battery.form.saving":"battery.form.submit")})})]})]})]}),w&&L&&e.jsx(de,{image:L,onClose:()=>{f(!1),_(null)},onCropComplete:y})]})}const hr={remotecontroller:"https://images.unsplash.com/photo-1511707171634-5f897ff02aa9?w=400&h=400&fit=crop",speaker:"https://images.unsplash.com/photo-1545454675-3531b543be5d?w=400&h=400&fit=crop",camera:"https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=400&h=400&fit=crop",gadget:"https://images.unsplash.com/photo-1586349906319-48d20e9d17e5?w=400&h=400&fit=crop",light:"https://images.unsplash.com/photo-1513506003901-1e6a229e2d15?w=400&h=400&fit=crop",toy:"https://images.unsplash.com/photo-1566576912321-d58ddd7a6088?w=400&h=400&fit=crop",other:"https://images.unsplash.com/photo-1581235720704-06d3acfcb36f?w=400&h=400&fit=crop"};async function bt(t,r){const{setCachedImage:a,getCachedImage:s}=z.getState();if(r){const n=s(r);if(n)return n;if(!r.startsWith("http")){const i=await Ye("device-images",r);if(i)return a(r,i),i}return r}return hr[t]}const br={remotecontroller:fe,speaker:ve,camera:je,gadget:ke,light:we,toy:Ne,other:le},yr=[{value:"remotecontroller",labelKey:"device.types.remotecontroller",icon:fe},{value:"speaker",labelKey:"device.types.speaker",icon:ve},{value:"camera",labelKey:"device.types.camera",icon:je},{value:"gadget",labelKey:"device.types.gadget",icon:ke},{value:"light",labelKey:"device.types.light",icon:we},{value:"toy",labelKey:"device.types.toy",icon:Ne},{value:"other",labelKey:"device.types.other",icon:le}],pr={overdue:{color:{background:"bg-red-50 dark:bg-red-900/20",text:"text-red-700 dark:text-red-400"}},nearingEnd:{color:{background:"bg-yellow-50 dark:bg-yellow-900/20",text:"text-yellow-700 dark:text-yellow-400"}},normal:{color:{background:"bg-blue-50 dark:bg-blue-900/20",text:"text-blue-700 dark:text-blue-400"}},notSet:{color:{background:"bg-gray-50 dark:bg-gray-800",text:"text-gray-600 dark:text-gray-300"}}};function yt(t){if(!t.last_battery_change||!t.has_batteries||t.battery_life_weeks===null||t.battery_life_weeks===void 0)return null;const r=new Date(t.last_battery_change),a=new Date(r);return a.setDate(a.getDate()+t.battery_life_weeks*7),a}function fr(t){const r=yt(t);if(!r)return"notSet";const a=new Date,s=(r.getTime()-a.getTime())/(1e3*60*60*24);return s<=0?"overdue":s<=7?"nearingEnd":"normal"}function vr({device:t}){const{t:r}=h();M();const[a,s]=u.useState(null),n=br[t.type],i=yt(t),l=fr(t);u.useEffect(()=>{bt(t.type,t.image_url).then(o=>s(o))},[t.type,t.image_url]);const d=pr[l];return e.jsx(T,{to:`/devices/${t.id}`,className:"block bg-white dark:bg-dark-card border border-gray-100 dark:border-dark-border rounded-xl shadow-sm hover:shadow-md hover:border-gray-200 dark:hover:border-gray-600 hover:scale-[1.01] transition-all duration-200",children:e.jsx("div",{className:"p-5",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"flex flex-wrap items-center mb-4 gap-2",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"text-xl font-medium text-gray-900 dark:text-dark-text truncate",children:t.name})}),t.notes&&e.jsx("div",{className:"mt-1.5 flex items-start",children:e.jsxs("div",{className:"flex items-start flex-1 mr-2",children:[e.jsx(Oe,{className:"h-3.5 w-3.5 text-gray-400 dark:text-gray-500 mt-0.5 mr-1.5 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 line-clamp-2",children:t.notes})]})})]})}),e.jsxs("div",{className:"flex mb-2 gap-2 flex-wrap",children:[e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-md bg-gray-50 dark:bg-gray-800 text-xs font-medium text-gray-600 dark:text-gray-300",children:[e.jsx(n,{className:"h-4 w-4 mr-1 text-gray-500 dark:text-gray-400"}),r(`device.types.${t.type}`)]}),e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-md bg-gray-50 dark:bg-gray-800 text-xs font-medium text-gray-600 dark:text-gray-300",children:[r(ee(t.battery_shape)),e.jsxs("span",{className:"ml-1 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 rounded-full px-1.5 py-0.5 text-xs font-medium",children:[t.battery_count,r("common.unit")]})]}),t.purchase_date&&e.jsxs("span",{className:"inline-flex items-center px-2.5 py-1 rounded-md bg-gray-50 dark:bg-gray-800 text-xs font-medium text-gray-600 dark:text-gray-300",children:[e.jsx(ue,{className:"h-4 w-4 mr-1 text-gray-400 dark:text-gray-500"}),r("common.purchase",{date:new Date(t.purchase_date).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex mb-4",children:[e.jsx("div",{className:"flex-shrink-0 mr-4",children:e.jsx("img",{src:a||"",alt:t.name,className:"w-20 h-20 rounded-lg object-cover shadow-sm"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"flex justify-between text-xs text-gray-500 mb-2",children:e.jsx("span",{children:r("device.status.batteryExchange")})}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[t.last_battery_change&&e.jsxs("div",{className:"inline-flex items-center px-2.5 py-1 rounded-full bg-blue-50 dark:bg-blue-900/20 text-xs text-blue-700 dark:text-blue-400",children:[e.jsx(ue,{className:"h-4 w-4 mr-1 text-gray-400 dark:text-gray-500"}),r("device.status.exchangeDate",{date:new Date(t.last_battery_change).toLocaleDateString()})]}),i?e.jsxs("div",{className:`inline-flex items-center px-2.5 py-1 rounded-full text-xs ${d.color.background} ${d.color.text}`,children:[e.jsx(ue,{className:"h-4 w-4 mr-1 text-gray-400 dark:text-gray-500"}),r("device.status.scheduleDate",{date:i.toLocaleDateString()}),l==="overdue"&&` (${r("device.status.overdue")})`,l==="nearingEnd"&&` (${r("device.status.soon")})`]}):e.jsxs("div",{className:"inline-flex items-center px-2.5 py-1 rounded-full bg-gray-50 dark:bg-gray-800 text-xs text-gray-600 dark:text-gray-300",children:[r("device.status.notSet")," (-)"]})]})]})]})]})})})}function Ie(t){if(!t.last_battery_change||!t.battery_life_weeks)return null;const r=new Date(t.last_battery_change),a=new Date(r);return a.setDate(a.getDate()+t.battery_life_weeks*7),a}function Te({title:t,devices:r,isOpen:a,onToggle:s,isDesktop:n}){return r.length===0?null:e.jsxs("div",{className:"bg-white dark:bg-dark-card shadow rounded-lg mb-4",children:[e.jsx("button",{onClick:s,className:"w-full px-4 py-3 flex items-center justify-between bg-gray-50 dark:bg-gray-800 rounded-t-lg hover:bg-gray-100 dark:hover:bg-gray-700",children:e.jsxs("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text flex items-center",children:[a?e.jsx(Pt,{className:"h-5 w-5 mr-2"}):e.jsx(Ae,{className:"h-5 w-5 mr-2"}),t,e.jsxs("span",{className:"ml-2 text-sm text-gray-500 dark:text-gray-400",children:["(",r.length,")"]})]})}),a&&e.jsx("div",{className:`p-4 grid gap-4 ${n?"grid-cols-2":"grid-cols-1"}`,children:r.map(i=>e.jsx(vr,{device:i},i.id))})]})}function jr(){const{t}=h(),{devices:r,loading:a}=nt(),s=We.useMediaQuery({minWidth:768}),[n,i]=u.useState(!1),[l,d]=u.useState("all"),[o,m]=u.useState("all"),[g,b]=u.useState("none"),[c,v]=u.useState(""),[p,L]=u.useState(!0),[_,w]=u.useState(!0),f={all:t("common.all"),remotecontroller:t("device.types.remotecontroller"),speaker:t("device.types.speaker"),camera:t("device.types.camera"),gadget:t("device.types.gadget"),light:t("device.types.light"),toy:t("device.types.toy"),other:t("device.types.other")},C=se.useMemo(()=>{let x=0;return l!=="all"&&x++,o!=="all"&&x++,g!=="none"&&x++,c!==""&&x++,x},[l,o,g,c]),D=se.useMemo(()=>{let x=[...r];return c!==""&&(x=x.filter(k=>k.name.toLowerCase().includes(c.toLowerCase())||k.notes&&k.notes.toLowerCase().includes(c.toLowerCase()))),l!=="all"&&(x=x.filter(k=>k.type===l)),o!=="all"&&(x=x.filter(k=>k.battery_shape===o)),g!=="none"&&x.sort((k,P)=>{if(g==="battery-end-asc"||g==="battery-end-desc"){const F=Ie(k),q=Ie(P);return!F&&!q?0:F?q?g==="battery-end-asc"?F.getTime()-q.getTime():q.getTime()-F.getTime():g==="battery-end-asc"?-1:1:g==="battery-end-asc"?1:-1}else{if(g==="name-asc"||g==="name-desc")return g==="name-asc"?k.name.localeCompare(P.name):P.name.localeCompare(k.name);{if(!k.last_battery_change&&!P.last_battery_change)return 0;if(!k.last_battery_change)return g==="asc"?1:-1;if(!P.last_battery_change)return g==="asc"?-1:1;const F=new Date(k.last_battery_change).getTime(),q=new Date(P.last_battery_change).getTime();return g==="asc"?F-q:q-F}}}),x},[r,c,l,o,g]),{withBatteries:B,withoutBatteries:y}=se.useMemo(()=>{const x=[],k=[];return D.forEach(P=>{P.has_batteries?x.push(P):k.push(P)}),{withBatteries:x,withoutBatteries:k}},[D]),I=()=>{d("all"),m("all"),b("none"),v("")};return a?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):e.jsxs("div",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4 mb-4",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 dark:text-dark-text",children:t("device.list.title")}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3",children:[e.jsxs("button",{onClick:()=>i(!n),className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),t("battery.list.filter"),C>0&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300",children:C})]}),e.jsx(kr,{devices:r})]})]}),e.jsx(wr,{devices:r}),n&&e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"bg-white dark:bg-dark-card p-5 rounded-xl shadow-sm border border-gray-100 dark:border-dark-border mb-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-4",children:[e.jsxs("div",{className:"relative flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Ke,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})}),e.jsx("input",{type:"text",placeholder:t("device.list.searchPlaceholder"),value:c,onChange:x=>v(x.target.value),className:"block w-full pl-10 pr-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-blue-500 focus:border-blue-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-300"})]}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{value:g,onChange:x=>b(x.target.value),className:"block w-full pl-3 pr-10 py-2 text-sm border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 focus:outline-none focus:ring-blue-500 focus:border-blue-500 appearance-none text-gray-900 dark:text-gray-300",children:[e.jsx("option",{value:"none",children:t("device.list.sortOptions.none")}),e.jsx("option",{value:"battery-end-asc",children:t("device.list.sortOptions.batteryEndAsc")}),e.jsx("option",{value:"battery-end-desc",children:t("device.list.sortOptions.batteryEndDesc")}),e.jsx("option",{value:"asc",children:t("device.list.sortOptions.changeAsc")}),e.jsx("option",{value:"desc",children:t("device.list.sortOptions.changeDesc")}),e.jsx("option",{value:"name-asc",children:t("device.list.sortOptions.nameAsc")}),e.jsx("option",{value:"name-desc",children:t("device.list.sortOptions.nameDesc")})]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx(qe,{className:"h-4 w-4 text-gray-400 dark:text-gray-500"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("device.list.deviceType")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Object.keys(f).map(x=>e.jsx("button",{onClick:()=>d(x),className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium ${l===x?"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:f[x]},x))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("device.list.batteryType")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","単1形","単2形","単3形","単4形","9V形"].map(x=>e.jsx("button",{onClick:()=>m(x),className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium ${o===x?"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:x==="all"?"すべて":x},x))})]})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{onClick:I,className:"text-sm text-blue-600 dark:text-blue-400 hover:text-blue-800 dark:hover:text-blue-500",children:t("device.list.resetFilter")})})]})]}),r.length===0?e.jsx("div",{className:"bg-white dark:bg-dark-card shadow rounded-xl overflow-hidden",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ae,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-dark-text",children:t("device.list.noDevices")}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:t("device.list.emptyStateMessage")}),e.jsx("div",{className:"mt-6",children:e.jsxs(T,{to:"/devices/new",className:"inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"新規登録"]})})]})}):D.length===0?e.jsx("div",{className:"bg-white dark:bg-dark-card shadow rounded-xl overflow-hidden",children:e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ne,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"mt-4 text-lg font-medium text-gray-900 dark:text-dark-text",children:t("device.list.noMatchingDevices")}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400 max-w-md mx-auto",children:t("device.list.noMatchingMessage")}),e.jsx("div",{className:"mt-6",children:e.jsxs("button",{onClick:I,className:"inline-flex items-center px-4 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),t("device.list.resetFilter")]})})]})}):e.jsxs("div",{className:"bg-white shadow rounded-xl overflow-hidden dark:bg-dark-bg",children:[e.jsx(Te,{title:t("device.list.withBatteries"),devices:B,isOpen:p,onToggle:()=>L(!p),isDesktop:s}),e.jsx(Te,{title:t("device.list.withoutBatteries"),devices:y,isOpen:_,onToggle:()=>w(!_),isDesktop:s})]})]})}function kr({devices:t}){const{t:r}=h(),{isLimitReached:a}=X();return a.devices(t.length)?e.jsx("div",{className:"relative inline-block",children:e.jsxs("button",{disabled:!0,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-gray-400 dark:bg-gray-600 cursor-not-allowed",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),r("device.list.addNew")]})}):e.jsxs(T,{to:"/devices/new",className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),r("device.list.addNew")]})}function wr({devices:t}){const{t:r}=h(),{userPlan:a,loading:s}=X(),n=M();if(s||!a)return null;const i=t.length,d=at(a).devices,o=i>=d;return a.plan_type==="free"?r("plan.free"):a.plan_type==="standard"?r("plan.standard"):r("plan.pro"),e.jsx("div",{className:`p-4 rounded-lg mb-4 ${o?"bg-amber-50 dark:bg-amber-900/20":"bg-blue-50 dark:bg-blue-900/20"}`,children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[o&&e.jsx(Ve,{className:"h-5 w-5 text-amber-500 dark:text-amber-400 flex-shrink-0 mt-0.5"}),e.jsx("div",{children:e.jsxs("p",{className:`text-sm mt-1 ${o?"text-amber-600 dark:text-amber-300":"text-blue-600 dark:text-blue-300"}`,children:[r("device.list.deviceCount",{current:i,max:d}),o&&` ${r("device.list.limitReached")}`]})})]}),o&&e.jsx("button",{className:"px-3 py-1 bg-blue-600 text-white text-sm rounded hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",onClick:()=>n("/settings"),children:r("device.list.changeInSettings")})]})})}function pt({isOpen:t,onClose:r,deviceId:a,deviceName:s}){const{data:n,isLoading:i}=O({queryKey:["deviceUsageHistory",a],queryFn:async()=>await Va(a),enabled:t});return t?e.jsx("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:e.jsxs("div",{className:"flex min-h-screen items-end justify-center px-4 pt-4 pb-20 text-center sm:block sm:p-0",children:[e.jsx("div",{className:"fixed inset-0 bg-gray-500 bg-opacity-75 dark:bg-gray-900 dark:bg-opacity-75 transition-opacity",onClick:r}),e.jsxs("div",{className:"inline-block align-bottom bg-white dark:bg-dark-card rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full sm:p-6",children:[e.jsx("div",{className:"absolute top-0 right-0 pt-4 pr-4",children:e.jsx("button",{type:"button",className:"bg-white dark:bg-dark-card rounded-md text-gray-400 hover:text-gray-500 dark:text-gray-300 dark:hover:text-gray-100 focus:outline-none",onClick:r,children:e.jsx(H,{className:"h-6 w-6"})})}),e.jsx("div",{className:"sm:flex sm:items-start",children:e.jsxs("div",{className:"mt-3 text-center sm:mt-0 sm:text-left w-full",children:[e.jsxs("h3",{className:"text-lg leading-6 font-medium text-gray-900 dark:text-dark-text",children:[s,"の電池交換履歴"]}),i?e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400"})}):n&&n.length>0?e.jsx("div",{className:"mt-4",children:e.jsx("div",{className:"flow-root",children:e.jsx("ul",{className:"-mb-8",children:n.map((l,d)=>e.jsx("li",{children:e.jsxs("div",{className:"relative pb-8",children:[d!==n.length-1?e.jsx("span",{className:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200 dark:bg-gray-700","aria-hidden":"true"}):null,e.jsxs("div",{className:"relative flex space-x-3",children:[e.jsx("div",{children:e.jsx("span",{className:"h-8 w-8 rounded-full bg-blue-100 dark:bg-blue-900/20 flex items-center justify-center ring-8 ring-white dark:ring-gray-900",children:e.jsx(U,{className:"h-5 w-5 text-blue-600 dark:text-blue-400"})})}),e.jsx("div",{className:"min-w-0 flex-1 pt-1.5 flex justify-between space-x-4",children:e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[l.batteries.battery_groups.name," #",l.batteries.slot_number,"を設置"]}),e.jsxs("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:[new Date(l.started_at).toLocaleString(),l.ended_at&&e.jsxs(e.Fragment,{children:[" → ",new Date(l.ended_at).toLocaleString()]})]})]})})]})]})},l.id))})})}):e.jsx("p",{className:"mt-4 text-sm text-gray-500 dark:text-gray-400",children:"電池交換履歴はありません"})]})})]})]})}):null}const S=ie((t,r)=>({id:null,isEditing:!1,editData:null,imageUrl:null,selectedImage:null,showCropper:!1,error:null,saving:!1,showHistory:!1,deleting:!1,showDeleteConfirm:!1,setId:a=>t({id:a}),setIsEditing:a=>t({isEditing:a}),setEditData:a=>t(s=>({editData:s.editData?{...s.editData,...a}:null})),setError:a=>t({error:a}),setImageUrl:a=>t({imageUrl:a}),setSelectedImage:a=>t({selectedImage:a}),setShowCropper:a=>t({showCropper:a}),setSaving:a=>t({saving:a}),setShowHistory:a=>t({showHistory:a}),setDeleting:a=>t({deleting:a}),setShowDeleteConfirm:a=>t({showDeleteConfirm:a}),initializeEditData:a=>t({editData:{name:a.name,type:a.type,batteryShape:a.battery_shape,batteryCount:a.battery_count,batteryLifeWeeks:a.battery_life_weeks||"",purchaseDate:a.purchase_date||"",notes:a.notes||""}}),resetEditData:a=>{t({editData:{name:a.name,type:a.type,batteryShape:a.battery_shape,batteryCount:a.battery_count,batteryLifeWeeks:a.battery_life_weeks||"",purchaseDate:a.purchase_date||"",notes:a.notes||""},isEditing:!1})},handleSave:async a=>{const{id:s,editData:n}=r();if(!(!s||!n)){t({saving:!0,error:null});try{if(await sa(s,{name:n.name,type:n.type,battery_shape:n.batteryShape,battery_count:n.batteryCount,battery_life_weeks:n.batteryLifeWeeks?Number(n.batteryLifeWeeks):null,purchase_date:n.purchaseDate||null,notes:n.notes||null}),a){const{invalidateDevices:i}=Se(a);await i()}t({isEditing:!1,saving:!1})}catch(i){t({error:i instanceof Error?i.message:"保存に失敗しました",saving:!1})}}},handleCancelEdit:a=>{r().resetEditData(a)},handleDelete:async()=>{const{id:a}=r();if(a){t({deleting:!0,error:null});try{await na(a),window.location.href="/devices"}catch(s){t({error:s instanceof Error?s.message:"削除に失敗しました",deleting:!1,showDeleteConfirm:!1})}}},handleImageSelect:async(a,s)=>{try{re(a);const n=new FileReader;n.onloadend=()=>{t({selectedImage:n.result,showCropper:!0})},n.readAsDataURL(a)}catch(n){console.error("画像選択エラー:",n),t({error:n instanceof Error?n.message:"画像の選択に失敗しました"})}},handleCropComplete:async(a,s)=>{if(s)try{const n=await Je();if(!n)throw new Error("ユーザー情報が取得できませんでした");await ut(n.id,s,a,null),t({showCropper:!1,selectedImage:null}),window.location.reload()}catch(n){console.error("画像アップロード処理エラー:",n),t({error:n instanceof Error?n.message:"画像のアップロードに失敗しました"})}},calculateBatteryEndDate:a=>{if(!a||!a.last_battery_change||!a.battery_life_weeks)return null;const s=new Date(a.last_battery_change),n=new Date(s);return n.setDate(n.getDate()+a.battery_life_weeks*7),n}})),Nr={smartphone:ae,speaker:ve,camera:je,gadget:ke,light:we,toy:Ne,remotecontroller:fe,other:le};function Sr({device:t}){const{t:r}=h(),a=be(),s=S(c=>c.isEditing),n=S(c=>c.editData),i=S(c=>c.setEditData),l=S(c=>c.handleSave),d=S(c=>c.handleCancelEdit),o=S(c=>c.setIsEditing),m=S(c=>c.setShowDeleteConfirm),g=S(c=>c.saving);if(!n)return null;const b=Nr[t.type];return e.jsx(gt,{icon:b,title:n.name,title_label:r("device.detail.titleLabel"),title_placeholder:r("device.detail.titlePlaceholder"),cannotDelete:r("device.detail.cannotDelete"),deleteGroup:r("device.list.deleteGroup"),created_at:new Date(t.created_at).toLocaleDateString(),installedCount:0,saving:g,isEditing:s,setEditData:i,onClickCancelEdit:()=>d(t),onClickSave:()=>l(a),onClickDelete:()=>m(!0),onClickEdit:()=>o(!0)})}function Dr({device:t}){const{t:r}=h(),a=S(v=>v.imageUrl),s=S(v=>v.handleImageSelect),n=u.useRef(null),{user:i}=K(),{isEditing:l,setShowCropper:d,setSelectedImage:o}=S(),[m,g]=se.useState(!1),b=async v=>{var L;const p=(L=v.target.files)==null?void 0:L[0];!p||!i||await s(p,i.id)},c=()=>{var v;l?(v=n.current)==null||v.click():a&&g(!0)};return e.jsxs("div",{className:"flex-shrink-0",children:[e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:a||"",alt:r("device.detail.imageAlt",{name:t.name}),className:"w-24 h-24 sm:w-32 sm:h-32 rounded-lg object-cover cursor-pointer",onClick:c}),l&&e.jsx("button",{onClick:()=>{var v;return(v=n.current)==null?void 0:v.click()},className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg",children:e.jsx(J,{className:"h-6 w-6 text-white"})}),e.jsx("input",{ref:n,type:"file",accept:"image/*",className:"hidden",onChange:b})]}),m&&a&&e.jsx(xt,{imageUrl:a,alt:r("device.detail.imageAlt",{name:t.name}),onClose:()=>g(!1)})]})}function te(t){return e.jsx("span",{className:"text-base font-medium text-gray-900 dark:text-dark-text",children:t.children})}function Cr({device:t}){const{t:r}=h(),a=S(o=>o.isEditing),s=S(o=>o.editData),n=S(o=>o.setEditData);if(!s)return null;const l=(o=>{switch(o){case"remotecontroller":return{label:r("device.types.remotecontroller")};case"speaker":return{label:r("device.types.speaker")};case"camera":return{label:r("device.types.camera")};case"gadget":return{label:r("device.types.gadget")};case"light":return{label:r("device.types.light")};case"toy":return{label:r("device.types.toy")};case"other":return{label:r("device.types.other")};default:return{label:r("device.types.other")}}})(t.type),d=o=>{const m=o.target.value;n({type:m})};return e.jsxs("div",{children:[e.jsx(W,{title:r("device.detail.deviceType")}),e.jsx("dd",{className:"mt-1",children:a?e.jsxs("select",{value:s.type,onChange:d,className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",children:[e.jsx("option",{value:"remotecontroller",children:r("device.types.remotecontroller")}),e.jsx("option",{value:"speaker",children:r("device.types.speaker")}),e.jsx("option",{value:"camera",children:r("device.types.camera")}),e.jsx("option",{value:"gadget",children:r("device.types.gadget")}),e.jsx("option",{value:"light",children:r("device.types.light")}),e.jsx("option",{value:"toy",children:r("device.types.toy")}),e.jsx("option",{value:"other",children:r("device.types.other")})]}):e.jsx("div",{className:"flex items-center",children:e.jsx(te,{children:l.label})})})]})}function Er({device:t,batteries:r=[]}){const{t:a}=h(),s=S(o=>o.isEditing),n=S(o=>o.editData),i=S(o=>o.setEditData),d=r.length>0;return n?e.jsxs("div",{children:[e.jsx(W,{title:a("device.detail.batteryShape")}),e.jsx("dd",{className:"mt-1",children:s?e.jsxs("div",{children:[e.jsxs("select",{value:n.batteryShape,onChange:o=>{i({batteryShape:o.target.value})},disabled:d,className:`block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${d?"bg-gray-100 cursor-not-allowed":""}`,children:[e.jsx("option",{value:"単1形",children:a("battery.shape.d")}),e.jsx("option",{value:"単2形",children:a("battery.shape.c")}),e.jsx("option",{value:"単3形",children:a("battery.shape.aa")}),e.jsx("option",{value:"単4形",children:a("battery.shape.aaa")}),e.jsx("option",{value:"9V形",children:a("battery.shape.9v")})]}),d&&e.jsx("p",{className:"mt-1 text-xs text-amber-600",children:a("device.detail.cannotChangeBatteryShape")})]}):e.jsx("div",{className:"flex items-center",children:e.jsx(te,{children:a(ee(t.battery_shape))})})})]}):null}function _r({device:t,batteries:r=[]}){const{t:a}=h(),s=S(o=>o.isEditing),n=S(o=>o.editData),i=S(o=>o.setEditData),d=r.length>0;return n?e.jsxs("div",{children:[e.jsx(W,{title:a("device.detail.batteryCount")}),e.jsx("dd",{className:"mt-1",children:s?e.jsxs("div",{children:[e.jsx("input",{type:"number",min:"1",value:n.batteryCount,onChange:o=>i({batteryCount:parseInt(o.target.value)}),disabled:d,className:`block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm ${d?"bg-gray-100 cursor-not-allowed":""}`}),d&&e.jsx("p",{className:"mt-1 text-xs text-amber-600",children:a("device.detail.cannotChangeBatteryShape")})]}):e.jsx("div",{className:"flex items-center",children:e.jsxs(te,{children:[t.battery_count,a("common.unit")]})})})]}):null}function Br({device:t}){const{t:r}=h(),a=S(i=>i.isEditing),s=S(i=>i.editData),n=S(i=>i.setEditData);return s?e.jsxs("div",{children:[e.jsx(W,{title:r("device.detail.batteryLife")}),e.jsx("dd",{className:"mt-1",children:a?e.jsxs("div",{className:"relative rounded-md shadow-sm",children:[e.jsx("input",{type:"number",min:"1",value:s.batteryLifeWeeks,onChange:i=>n({batteryLifeWeeks:i.target.value}),className:"block w-full border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500 sm:text-sm pr-8",placeholder:r("device.detail.batteryLifePlaceholder")}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 sm:text-sm",children:r("device.detail.weeks")})})]}):e.jsx("div",{className:"flex items-center",children:e.jsx(te,{children:t.battery_life_weeks?r("device.detail.weeksValue",{weeks:t.battery_life_weeks}):"---"})})})]}):null}function Lr({device:t}){const{t:r}=h(),a=S(i=>i.isEditing),s=S(i=>i.editData),n=S(i=>i.setEditData);return s?e.jsxs("div",{children:[e.jsx(W,{title:r("device.detail.purchaseDate")}),e.jsx("dd",{className:"mt-1",children:a?e.jsx("input",{type:"date",value:s.purchaseDate,onChange:i=>n({purchaseDate:i.target.value}),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm"}):e.jsx("div",{className:"flex items-center",children:e.jsx(te,{children:t.purchase_date?new Date(t.purchase_date).toLocaleDateString():"---"})})})]}):null}function Ir({device:t,batteries:r=[]}){const{t:a}=h(),n=S(g=>g.calculateBatteryEndDate)(t),i=new Date,l=n?(new Date(n).getTime()-i.getTime())/(1e3*60*60*24):null,d=l!==null&&l<=0,o=l!==null&&l>0&&l<=7,m=t.battery_count>0&&r.length===t.battery_count;return e.jsxs("div",{children:[e.jsx(W,{title:a("device.detail.lastChange")}),e.jsxs("dd",{className:"mt-1",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(te,{children:t.last_battery_change?new Date(t.last_battery_change).toLocaleDateString():"---"})}),n&&m&&e.jsx("div",{className:"mt-2 text-sm",children:e.jsxs("span",{className:`inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${d?"bg-red-100 text-red-800":o?"bg-yellow-100 text-yellow-800":"bg-blue-100 text-blue-800"}`,children:[a("device.status.scheduleDate",{date:n.toLocaleDateString()}),d&&` (${a("device.status.overdue")})`,o&&` (${a("device.status.soon")})`]})})]})]})}function Tr({device:t}){const{t:r}=h(),a=S(i=>i.isEditing),s=S(i=>i.editData),n=S(i=>i.setEditData);return s?e.jsxs("div",{className:"sm:col-span-2",children:[e.jsx(W,{title:r("device.detail.notes")}),e.jsx("dd",{className:"mt-1",children:a?e.jsx("textarea",{rows:3,value:s.notes,onChange:i=>n({notes:i.target.value}),className:"block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm",placeholder:r("device.detail.notesPlaceholder")}):e.jsx("div",{className:"bg-gray-50 p-3 rounded-md text-gray-900 whitespace-pre-wrap dark:bg-gray-700 dark:text-gray-300",children:t.notes||"---"})})]}):null}function Rr({device:t,batteries:r=[]}){return e.jsx(ce,{header:e.jsx(Sr,{device:t}),children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-row space-x-4",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx(Dr,{device:t})}),e.jsx("div",{className:"flex-1 min-w-0",children:e.jsxs("dl",{className:"grid grid-cols-1 gap-x-4 gap-y-4 lg:grid-cols-3 sm:grid-cols-2",children:[e.jsx(Cr,{device:t}),e.jsx(Er,{device:t,batteries:r}),e.jsx(_r,{device:t,batteries:r}),e.jsx(Lr,{device:t}),e.jsx(Br,{device:t}),e.jsx(Ir,{device:t,batteries:r})]})})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Tr,{device:t})})]})})}function Re({slotNumber:t,battery:r}){var i;const{t:a}=h();if(!r)return e.jsx("div",{className:"px-4 py-4 sm:px-6 bg-white dark:bg-dark-card border-b border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between",children:[e.jsxs("div",{className:"mb-2 sm:mb-0",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900 dark:text-dark-text flex items-center",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 text-xs mr-2 flex-shrink-0",children:t}),a("device.batterySlot")," #",t]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:a("device.status.notSet")})]}),e.jsx("div",{className:"flex items-center",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300",children:a("device.status.notSet")})})]})});const s=he[r.status],n=s.icon;return e.jsx("div",{className:"px-4 py-4 sm:px-6 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors border-b border-gray-100 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between",children:[e.jsxs("div",{className:"mb-2 sm:mb-0",children:[e.jsxs("h4",{className:"text-sm font-medium text-gray-900 dark:text-dark-text flex items-center",children:[e.jsx("span",{className:"inline-flex items-center justify-center w-6 h-6 rounded-full bg-blue-100 dark:bg-blue-900 text-blue-700 dark:text-blue-300 text-xs mr-2 flex-shrink-0",children:t}),(i=r.battery_groups)==null?void 0:i.name," #",r.slot_number]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-x-4 gap-y-1",children:[e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsxs("span",{className:"w-24 inline-block flex-shrink-0",children:[a("device.detail.lastCheck"),":"]}),e.jsx("span",{className:"font-medium dark:text-gray-200",children:r.last_checked?new Date(r.last_checked).toLocaleDateString():"---"})]}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400 flex items-center",children:[e.jsxs("span",{className:"w-24 inline-block flex-shrink-0",children:[a("device.detail.lastChange"),":"]}),e.jsx("span",{className:"font-medium dark:text-gray-200",children:r.last_changed_at?new Date(r.last_changed_at).toLocaleDateString():"---"})]})]})]}),e.jsx("div",{className:"flex items-center",children:e.jsxs("span",{className:`inline-flex items-center px-3 py-1 rounded-full text-xs font-medium ${s.color.background} ${s.color.text}`,children:[e.jsx(n,{className:"h-4 w-4 mr-1"}),a(`battery.status.${r.status}`)]})})]})})}function Pr({device:t,batteries:r,onClickShowHistory:a}){const{t:s}=h(),n=r.length;return e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center mb-4 sm:mb-0",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text",children:s("device.batterySection")}),e.jsx("span",{className:"ml-4 text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full dark:bg-gray-700 dark:text-gray-300",children:s("device.detail.installedBatteries",{installed:n,remaining:t.battery_count-n})})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 sm:gap-4",children:[e.jsxs("button",{onClick:a,className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),s("device.select.history")]}),e.jsxs(T,{to:`/devices/${t.id}/select-battery`,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),s("device.selectBattery")]})]})]})}function Fr({device:t,batteries:r}){const{t:a}=h(),s=S(n=>n.setShowHistory);return e.jsx(ce,{header:e.jsx(Pr,{device:t,batteries:r,onClickShowHistory:()=>s(!0)}),children:e.jsxs("div",{children:[r.map((n,i)=>e.jsx(Re,{slotNumber:i+1,battery:n},n.id)),Array.from({length:t.battery_count-r.length}).map((n,i)=>e.jsx(Re,{slotNumber:r.length+i+1},`empty-${i}`))]})})}function Ar(){const{t}=h(),{id:r}=pe(),a=M(),{device:s,batteries:n,loading:i}=it(r||""),{id:l,setId:d,editData:o,initializeEditData:m,error:g,setError:b,imageUrl:c,setImageUrl:v,showHistory:p,selectedImage:L,showCropper:_,setIsEditing:w,showDeleteConfirm:f,setShowDeleteConfirm:C,handleDelete:D,deleting:B}=S();if(u.useEffect(()=>{r&&r!==l&&d(r)},[r,l,d]),u.useEffect(()=>{s&&r===l&&(m(s),w(!1),bt(s.type,s.image_url).then(I=>v(I)))},[s,l,r,m,v,w]),i||!s||!o)return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-bg flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})});const y=I=>S.getState().handleCropComplete(I,s.id);return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-bg",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>a("/devices"),className:"inline-flex items-center text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),t("device.detail.backToList")]})}),g&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:g})}),e.jsx(Rr,{device:s,batteries:n}),e.jsx(Fr,{device:s,batteries:n}),e.jsx(pt,{isOpen:p,onClose:()=>S.getState().setShowHistory(!1),deviceId:s.id,deviceName:s.name}),_&&L&&e.jsx(de,{image:L,onClose:()=>{S.getState().setShowCropper(!1),S.getState().setSelectedImage(null)},onCropComplete:y}),e.jsx(Ce,{isOpen:f,onClose:()=>C(!1),onConfirm:D,title:t("device.detail.deleteConfirmTitle"),message:t("device.detail.deleteConfirmMessage",{name:s.name}),loading:B})]})})}function Gr({value:t,onChange:r,className:a=""}){const{t:s}=h();return e.jsx("div",{className:`grid grid-cols-1 gap-3 sm:grid-cols-3 ${a}`,children:yr.map(n=>{const i=n.icon;return e.jsx("div",{className:`relative flex cursor-pointer rounded-lg border p-4 focus:outline-none ${t===n.value?"border-blue-500 ring-2 ring-blue-500 dark:border-blue-600 dark:ring-blue-600":"border-gray-300 dark:border-gray-600"}`,onClick:()=>r(n.value),children:e.jsx("div",{className:"flex w-full items-center justify-between",children:e.jsx("div",{className:"flex items-center",children:e.jsxs("div",{className:"text-sm",children:[e.jsx(i,{className:"h-5 w-5 text-gray-400 dark:text-gray-500 mr-2"}),e.jsx("p",{className:"font-medium text-gray-900 dark:text-dark-text",children:s(n.labelKey)})]})})})},n.value)})})}function $r(){const{t}=h(),r=M(),{user:a}=K(),{devices:s}=nt(),{isLimitReached:n}=X(),[i,l]=u.useState(!1),[d,o]=u.useState(null),[m,g]=u.useState({name:"",type:"remotecontroller",batteryShape:"単3形",batteryCount:1,batteryLifeWeeks:null,purchaseDate:null,notes:null}),b=u.useRef(null),[c,v]=u.useState(null),[p,L]=u.useState(!1),[_,w]=u.useState(null),f=n.devices(s.length),C=y=>{var x;const I=(x=y.target.files)==null?void 0:x[0];if(!(!I||!a))try{re(I);const k=new FileReader;k.onloadend=()=>{v(k.result),L(!0)},k.readAsDataURL(I)}catch(k){console.error(t("battery.detail.imageSelectError"),k),o(k instanceof Error?k.message:t("battery.detail.imageSelectFailed"))}},D=async y=>{w(y),L(!1),v(URL.createObjectURL(y))},B=async y=>{if(y.preventDefault(),!!a){if(f){o(t("device.form.limitReachedError"));return}l(!0),o(null);try{const I=await ra({name:m.name,type:m.type,battery_shape:m.batteryShape,battery_count:m.batteryCount,battery_life_weeks:m.batteryLifeWeeks?Number(m.batteryLifeWeeks):null,purchase_date:m.purchaseDate||null,notes:m.notes||null,user_id:a.id});if(_)try{await ut(a.id,I.id,_)}catch(x){console.error(t("battery.detail.imageUploadError"),x)}r("/devices")}catch(I){o(I instanceof Error?I.message:t("device.form.createError")),l(!1)}}};return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx("div",{className:"mb-6",children:e.jsxs("button",{onClick:()=>r("/devices"),className:"inline-flex items-center text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),t("device.detail.backToList")]})}),e.jsxs("div",{className:"bg-white dark:bg-dark-card shadow rounded-lg overflow-hidden",children:[e.jsx("div",{className:"px-4 py-5 sm:px-6 bg-gray-50 dark:bg-gray-800",children:e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-dark-text",children:t("device.form.title")})}),e.jsxs("form",{onSubmit:B,className:"px-4 py-5 sm:p-6 space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("battery.form.imageLabel")}),c?e.jsxs("div",{className:"relative group",children:[e.jsx("img",{src:c,alt:t("device.detail.imageAlt",{name:m.name||m.type}),className:"w-32 h-32 rounded-lg object-cover border border-gray-200 dark:border-gray-700"}),e.jsx("button",{type:"button",onClick:()=>{var y;return(y=b.current)==null?void 0:y.click()},className:"absolute inset-0 flex items-center justify-center bg-black dark:bg-gray-900 bg-opacity-50 dark:bg-opacity-70 opacity-0 group-hover:opacity-100 transition-opacity rounded-lg",children:e.jsx(J,{className:"h-6 w-6 text-white dark:text-gray-300"})})]}):e.jsxs("button",{type:"button",onClick:()=>{var y;return(y=b.current)==null?void 0:y.click()},className:"flex items-center justify-center w-32 h-32 border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg hover:border-gray-400 dark:hover:border-gray-500 focus:outline-none",children:[e.jsx(J,{className:"h-6 w-6 text-gray-400 dark:text-gray-500 mb-1"}),e.jsx("span",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:t("battery.form.uploadImage")})]}),e.jsx("input",{ref:b,type:"file",accept:"image/*",className:"hidden",onChange:C}),e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:t("battery.form.imageHelp")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"name",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("device.form.nameLabel")}),e.jsx("input",{type:"text",id:"name",required:!0,value:m.name,onChange:y=>g({...m,name:y.target.value}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 dark:bg-gray-700 dark:text-gray-300 sm:text-sm"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:t("device.detail.deviceType")}),e.jsx(Gr,{value:m.type,onChange:y=>g({...m,type:y})})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"batteryShape",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("device.detail.batteryShape")}),e.jsxs("select",{id:"batteryShape",value:m.batteryShape,onChange:y=>g({...m,batteryShape:y.target.value}),className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md dark:bg-gray-700 dark:text-gray-300",children:[e.jsx("option",{value:"単1形",children:t("battery.shape.d")}),e.jsx("option",{value:"単2形",children:t("battery.shape.c")}),e.jsx("option",{value:"単3形",children:t("battery.shape.aa")}),e.jsx("option",{value:"単4形",children:t("battery.shape.aaa")}),e.jsx("option",{value:"9V形",children:t("battery.shape.9v")})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"batteryCount",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("device.form.batteryCountLabel")}),e.jsx("input",{type:"number",id:"batteryCount",min:"1",required:!0,value:m.batteryCount,onChange:y=>g({...m,batteryCount:parseInt(y.target.value)}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-gray-300"})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"batteryLifeWeeks",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("device.detail.batteryLife")}),e.jsxs("div",{className:"mt-1 relative rounded-md shadow-sm",children:[e.jsx("input",{type:"number",id:"batteryLifeWeeks",min:"1",value:m.batteryLifeWeeks||"",onChange:y=>g({...m,batteryLifeWeeks:y.target.value?parseInt(y.target.value):null}),placeholder:t("device.detail.batteryLifePlaceholder"),className:"block w-full border-gray-300 dark:border-gray-600 rounded-md focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-gray-300"}),e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:e.jsx("span",{className:"text-gray-500 dark:text-gray-400 sm:text-sm",children:t("device.detail.weeks")})})]}),e.jsx("p",{className:"mt-2 text-sm text-gray-500 dark:text-gray-400",children:t("device.form.batteryLifeHelp")})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"purchaseDate",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("device.detail.purchaseDate")}),e.jsx("input",{type:"date",id:"purchaseDate",value:m.purchaseDate||"",onChange:y=>g({...m,purchaseDate:y.target.value}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-gray-300"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"notes",className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:t("device.detail.notes")}),e.jsx("textarea",{id:"notes",rows:3,value:m.notes||"",onChange:y=>g({...m,notes:y.target.value}),className:"mt-1 block w-full border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 sm:text-sm dark:bg-gray-700 dark:text-gray-300"})]}),d&&e.jsx("div",{className:"text-red-600 dark:text-red-400 text-sm",children:d}),e.jsx("div",{className:"flex justify-end",children:e.jsx("button",{type:"submit",disabled:i,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-700 dark:hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:t(i?"device.form.saving":"device.form.submit")})})]})]})]})}),p&&c&&e.jsx(de,{image:c,onClose:()=>{L(!1),v(null)},onCropComplete:D})]})}function Mr(){return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400"})})}function Ur({navigate:t}){const{t:r}=h();return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-xl text-gray-600 dark:text-gray-400",children:r("device.select.deviceNotFound")}),e.jsxs("button",{onClick:()=>t("/devices"),className:"mt-4 inline-flex items-center text-blue-600 hover:text-blue-800 dark:text-blue-400 dark:hover:text-blue-300",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),r("device.detail.backToList")]})]})})}function Or({navigate:t,deviceId:r,setShowFilters:a,showFilters:s,activeFiltersCount:n,setShowHistory:i,handleConfirm:l,saving:d}){const{t:o}=h();return e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("button",{onClick:()=>t(`/devices/${r}`),className:"inline-flex items-center text-gray-600 hover:text-gray-800 dark:text-gray-400 dark:hover:text-gray-300",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),o("device.select.backToDevice")]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("button",{onClick:()=>a(!s),className:"inline-flex items-center px-3 py-2 border border-gray-300 dark:border-gray-600 shadow-sm text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[e.jsx(ne,{className:"h-4 w-4 mr-2"}),o("device.select.filter"),n>0&&e.jsx("span",{className:"ml-2 inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:n})]}),e.jsxs("button",{onClick:()=>i(!0),className:"inline-flex items-center px-3 py-1 rounded-full text-sm font-medium bg-gray-100 dark:bg-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600",children:[e.jsx(ye,{className:"h-4 w-4 mr-1"}),o("device.select.history")]}),e.jsx("button",{onClick:l,disabled:d,className:"inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50",children:o(d?"device.select.saving":"device.select.confirm")})]})]})})}function Kr(t,r){switch(t){case"charged":return r("battery.status.charged");case"in_use":return r("battery.status.in_use");case"empty":return r("battery.status.empty");case"disposed":return r("battery.status.disposed");default:return r("battery.status.unknown")}}function qr(t,r){switch(t){case"all":return r("common.all");case"disposable":return r("battery.kind.disposable");case"rechargeable":return r("battery.kind.rechargeable");default:return t}}function Hr({statusFilter:t,setStatusFilter:r,kindFilter:a,setKindFilter:s,activeFiltersCount:n,resetFilters:i}){const{t:l}=h();return e.jsxs("div",{className:"bg-white dark:bg-dark-card p-4 rounded-lg shadow-sm mb-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 dark:text-gray-300",children:l("device.select.filterTitle")}),n>0&&e.jsxs("button",{onClick:i,className:"inline-flex items-center px-2 py-1 text-xs font-medium text-gray-700 dark:text-gray-300 hover:text-gray-900 dark:hover:text-gray-100",children:[e.jsx(H,{className:"h-3 w-3 mr-1"}),l("device.select.reset")]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:l("device.select.batteryStatus")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["charged","in_use","empty","disposed"].map(d=>e.jsx("button",{onClick:()=>{r(t.includes(d)?t.filter(o=>o!==d):[...t,d])},className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium ${t.includes(d)?"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:Kr(d,l)},d))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:l("device.select.batteryType")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:["all","disposable","rechargeable"].map(d=>e.jsx("button",{onClick:()=>s(d),className:`inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium ${a===d?"bg-blue-100 dark:bg-blue-900/20 text-blue-800 dark:text-blue-300":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600"}`,children:qr(d,l)},d))})]})]})]})}function Wr({device:t,batteryShape:r}){const a=ee(r),{t:s}=h();return e.jsx("div",{className:"bg-white dark:bg-dark-card shadow rounded-lg overflow-hidden mb-6",children:e.jsxs("div",{className:"px-4 py-5 sm:px-6 bg-gray-50 dark:bg-gray-800",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-dark-text",children:s("device.select.settingTitle")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:s("device.select.settingDescription",{deviceName:t.name,batteryType:s(a),count:t.battery_count})})]})})}function Vr({battery:t,group:r,device:a,deviceId:s,selectedBatteries:n,handleToggleBattery:i}){const{t:l}=h(),d=n.some(b=>b.batteryId===t.id),m=t.device_id!==null&&t.device_id!==s,g=!d&&(n.length>=a.battery_count||m);return e.jsx("button",{onClick:()=>!m&&i(r.id,t.id,t.status),disabled:g,className:`relative flex items-center p-4 border rounded-lg ${d?"border-blue-500 ring-2 ring-blue-500 dark:border-blue-600 dark:ring-blue-600":m?"border-gray-200 bg-gray-50 dark:border-gray-700 dark:bg-gray-800 cursor-not-allowed":"border-gray-300 hover:border-gray-400 dark:border-gray-600 dark:hover:border-gray-500"} ${g&&!m?"opacity-50 cursor-not-allowed":""} bg-white dark:bg-dark-card`,children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm font-medium text-gray-900 dark:text-dark-text",children:["#",t.slot_number]}),e.jsx("div",{className:"mt-1",children:e.jsx(ot,{status:t.status})}),m&&t.devices&&e.jsx("p",{className:"mt-1 text-xs text-gray-500 dark:text-gray-400",children:l("device.status.installedIn",{deviceName:t.devices.name})})]})},t.id)}function zr(){const{t}=h(),{deviceId:r}=pe(),a=M(),s=be(),{user:n}=K(),{device:i,batteries:l,loading:d}=it(r||""),{availableBatteryGroups:o,loading:m}=Ea((i==null?void 0:i.battery_shape)??""),[g,b]=u.useState([]),[c,v]=u.useState(!1),[p,L]=u.useState(!1),[_,w]=u.useState(null),[f,C]=u.useState(!1),[D,B]=u.useState(["charged","in_use"]),[y,I]=u.useState("all"),[x,k]=u.useState(0);if(u.useEffect(()=>{let E=0;D.length!==4&&E++,y!=="all"&&E++,k(E)},[D,y]),u.useEffect(()=>{l.length>0&&b(l.map(E=>({groupId:E.group_id,batteryId:E.id,status:E.status})))},[l]),d||m)return e.jsx(Mr,{});if(!i)return e.jsx(Ur,{navigate:a});const P=(E,G,R)=>{b(Q=>Q.some(me=>me.batteryId===G)?Q.filter(me=>me.batteryId!==G):Q.length<i.battery_count?[...Q,{groupId:E,batteryId:G,status:R}]:Q)},F=async()=>{if(!(!n||!r)){L(!0),w(null);try{await Ya(r,g.map(R=>R.batteryId),n.id);const{invalidateBatteries:E,invalidateDevices:G}=_a(s);await Promise.all([E(),G()]),a(`/devices/${r}`)}catch(E){w(E instanceof Error?E.message:t("device.select.createError")),L(!1)}}},q=()=>{B(["charged","in_use"]),I("all")},Ee=[...o].sort((E,G)=>E.name.localeCompare(G.name,"ja")).filter(E=>y==="all"||E.kind===y).map(E=>{const G=E.batteries?E.batteries.map(R=>({...R,slot_number:R.slot_number||0,status:R.status||"empty",devices:R.devices||null,id:R.id||"",group_id:R.group_id||E.id,device_id:R.device_id||null,created_at:R.created_at||"",user_id:R.user_id||""})):[];return{...E,batteries:G}}),Dt=ee(i.battery_shape);return e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-3xl mx-auto py-8 px-4 sm:px-6 lg:px-8",children:[e.jsx(Or,{navigate:a,deviceId:r,setShowFilters:C,showFilters:f,activeFiltersCount:x,setShowHistory:v,handleConfirm:F,saving:p}),f&&e.jsx(Hr,{statusFilter:D,setStatusFilter:B,kindFilter:y,setKindFilter:I,activeFiltersCount:x,resetFilters:q}),e.jsx(Wr,{device:i,batteryShape:i.battery_shape}),Ee.length===0?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx(U,{className:"mx-auto h-12 w-12 text-gray-400 dark:text-gray-500"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-dark-text",children:t("device.select.noBatteries")}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:t("device.select.registerNew",{batteryType:t(Dt)})})]}):e.jsx("div",{className:"bg-white dark:bg-dark-card shadow rounded-lg overflow-hidden mb-6",children:e.jsx("div",{className:"divide-y divide-gray-200 dark:divide-dark-border",children:Ee.map(E=>{const G=(E.batteries||[]).filter(R=>D.includes(R.status)).sort((R,Q)=>R.slot_number-Q.slot_number);return G.length===0?null:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-dark-text",children:E.name}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:t("battery.list.total",{count:G.length})})]}),e.jsx("div",{className:"flex items-center space-x-2",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${E.kind==="rechargeable"?"bg-green-100 dark:bg-green-900/20 text-green-800 dark:text-green-400":"bg-gray-100 dark:bg-gray-700 text-gray-800 dark:text-gray-300"}`,children:E.kind==="rechargeable"?t("battery.kind.rechargeable"):t("battery.kind.disposable")})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-3",children:G.map(R=>e.jsx(Vr,{battery:R,group:E,device:i,deviceId:r||"",selectedBatteries:g,handleToggleBattery:P},R.id))})]},E.id)})})}),_&&e.jsx("div",{className:"mt-4 p-4 bg-red-50 dark:bg-red-900/20 rounded-md",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:_})}),e.jsx(pt,{isOpen:c,onClose:()=>v(!1),deviceId:r||"",deviceName:i.name})]})})}function Qr(){const[t,r]=u.useState(null),[a,s]=u.useState(!0);return u.useEffect(()=>{Ze().then(({session:i})=>{r((i==null?void 0:i.user)??null),s(!1)});const{subscription:n}=Xe((i,l)=>{r((l==null?void 0:l.user)??null)});return()=>n.unsubscribe()},[]),{user:t,loading:a}}function ft(){const{i18n:t}=h(),r=t.language,a=s=>{t.changeLanguage(s)};return e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>a("ja"),className:`px-2 py-1 text-xs rounded transition-colors ${r==="ja"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"日本語"}),e.jsx("button",{onClick:()=>a("en"),className:`px-2 py-1 text-xs rounded transition-colors ${r==="en"?"bg-blue-500 text-white":"bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-600"}`,children:"English"})]})}function Yr(){const{t}=h(),r=M(),{user:a}=Qr(),s=lt(),[n,i]=u.useState(!1),[l,d]=u.useState(null),[o,m]=u.useState(null);if(u.useEffect(()=>{a&&rt(a.id).then(m)},[a]),!o)return e.jsx("div",{className:"p-4 dark:text-dark-text",children:t("common.loading")});const g=b=>{alert(t("userSettings.planLimits.upgrade.upgradeInDevelopment"))};return e.jsxs("div",{className:"max-w-4xl mx-auto p-4 dark:bg-dark-bg min-h-screen",children:[e.jsx("h1",{className:"text-2xl font-bold mb-8 dark:text-dark-text",children:t("userSettings.title")}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 dark:text-dark-text",children:t("userSettings.darkMode.title")}),e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("div",{children:e.jsx("p",{className:"text-gray-700 dark:text-dark-text",children:t("userSettings.darkMode.description")})}),e.jsxs("button",{onClick:s.toggle,className:"relative inline-flex items-center gap-4 px-4 py-2 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-colors",role:"switch","aria-checked":s.isDark,tabIndex:0,onKeyDown:b=>{(b.key===" "||b.key==="Enter")&&(b.preventDefault(),s.toggle())},children:[e.jsx(Ft,{className:`w-5 h-5 transition-transform ${s.isDark?"text-gray-400":"text-yellow-500 rotate-0"}`}),e.jsx("div",{className:`relative w-14 h-7 rounded-full transition-colors ${s.isDark?"bg-blue-600":"bg-gray-200"}`,children:e.jsx("div",{className:`absolute top-1 left-1 w-5 h-5 rounded-full bg-white transform transition-transform ${s.isDark?"translate-x-7":"translate-x-0"}`})}),e.jsx(At,{className:`w-5 h-5 transition-transform ${s.isDark?"text-blue-200":"text-gray-400"}`})]})]})})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 dark:text-dark-text",children:t("userSettings.language")}),e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-4",children:e.jsx(ft,{})})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 dark:text-dark-text",children:t("userSettings.planLimits.title")}),e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-4 mb-4",children:e.jsx("div",{className:"flex justify-between items-center",children:e.jsx("div",{children:e.jsx("p",{className:"text-gray-700 dark:text-dark-text font-medium",children:t("userSettings.planLimits.currentPlan",{plan:t(`plan.${o.plan_type}`)})})})})}),e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-4 mb-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-gray-700 dark:text-dark-text",children:t("userSettings.planLimits.batteryGroups")}),e.jsx("span",{className:"text-gray-900 dark:text-dark-text font-medium",children:t("userSettings.planLimits.of",{max:o.max_battery_groups})})]})}),e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-4 mb-4",children:e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-gray-700 dark:text-dark-text",children:t("userSettings.planLimits.devices")}),e.jsx("span",{className:"text-gray-900 dark:text-dark-text font-medium",children:t("userSettings.planLimits.of",{max:o.max_devices})})]})}),o.plan_type!=="pro"&&e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("p",{className:"text-gray-700 dark:text-dark-text",children:t(`userSettings.planLimits.upgrade.description.${o.plan_type}`)}),o.plan_type==="free"&&e.jsxs("button",{onClick:()=>g(),className:"w-full flex items-center justify-center bg-blue-500 text-white rounded-md py-2 px-4 hover:bg-blue-600 transition-colors",children:[t("userSettings.planLimits.upgrade.toStandard"),e.jsx(Be,{className:"ml-2 h-4 w-4"})]}),(o.plan_type==="free"||o.plan_type==="standard")&&e.jsxs("button",{onClick:()=>g(),className:"w-full flex items-center justify-center bg-purple-500 text-white rounded-md py-2 px-4 hover:bg-purple-600 transition-colors",children:[t("userSettings.planLimits.upgrade.toPro"),e.jsx(Be,{className:"ml-2 h-4 w-4"})]})]})})]}),e.jsxs("section",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 dark:text-dark-text",children:t("userSettings.logout.title")}),e.jsx("div",{className:"bg-white dark:bg-dark-card rounded-lg shadow p-4",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsx("p",{className:"text-gray-700 dark:text-dark-text",children:t("userSettings.logout.description")}),l&&e.jsx("div",{className:"text-sm text-center text-red-600",children:l}),e.jsx("button",{onClick:async()=>{try{i(!0),d(null),await Yt(),r("/login")}catch(b){d(b instanceof Error?b.message:t("userSettings.logout.error"))}finally{i(!1)}},disabled:n,className:"w-full bg-red-500 text-white rounded-md py-2 px-4 hover:bg-red-600 transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:t(n?"userSettings.logout.processing":"userSettings.logout.button")})]})})]})]})}function Jr(){const t=M(),{user:r}=K(),[a,s]=u.useState(!1),[n,i]=u.useState(null);u.useEffect(()=>{r&&t("/")},[r,t]);const l=async()=>{if(!a){s(!0),i(null);try{await Qt()}catch(d){i(d instanceof Error?d.message:"ログインに失敗しました"),s(!1)}}};return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"max-w-md w-full space-y-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"BattDevy"}),e.jsx("p",{className:"mt-2 text-center text-sm text-gray-600",children:"Googleアカウントでログインしてください"})]}),n&&e.jsx("div",{className:"text-sm text-center text-red-600",children:n}),e.jsx("div",{className:"flex flex-col space-y-4",children:e.jsx("button",{type:"button",onClick:l,disabled:a,className:"group relative w-full flex justify-center py-2 px-4 border border-transparent text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 disabled:opacity-50 disabled:cursor-not-allowed",children:e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{className:"w-5 h-5 mr-2",viewBox:"0 0 24 24",children:e.jsx("path",{fill:"currentColor",d:"M12.545,10.239v3.821h5.445c-0.712,2.315-2.647,3.972-5.445,3.972c-3.332,0-6.033-2.701-6.033-6.032s2.701-6.032,6.033-6.032c1.498,0,2.866,0.549,3.921,1.453l2.814-2.814C17.503,2.988,15.139,2,12.545,2C7.021,2,2.543,6.477,2.543,12s4.478,10,10.002,10c8.396,0,10.249-7.85,9.426-11.748L12.545,10.239z"})}),a?"ログイン中...":"Googleでログイン"]})})})]})})}function V({children:t}){const{user:r,loading:a}=K(),s=M();return u.useEffect(()=>{!a&&!r&&s("/login")},[r,a,s]),a?e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"})}):r?e.jsx(e.Fragment,{children:t}):null}const vt=(t,r)=>({ja:{title:"BattDevy - スマートな電池管理アプリ | デバイスの電池状況をリアルタイムで追跡",description:"電池切れの不安を解消する、デバイスの電池管理アプリ。リアルタイムで電池状況を追跡し、効率的に管理できます。",keywords:["電池管理","バッテリー追跡","デバイス電池","スマートアプリ","電池切れ通知","電池在庫管理","バッテリーライフ"],ogTitle:"BattDevy - スマートな電池管理アプリ",ogDescription:"電池切れの不安を解消する、デバイスの電池管理アプリ",ogImage:"/og-image-ja.png"},en:{title:"BattDevy - Smart Battery Management App | Real-Time Device Battery Tracking",description:"Eliminate battery anxiety with our device battery management app. Track battery status in real-time and manage efficiently.",keywords:["battery management","battery tracking","device battery","smart app","battery depletion alerts","battery inventory","battery life"],ogTitle:"BattDevy - Smart Battery Management App",ogDescription:"Eliminate battery anxiety with our device battery management app",ogImage:"/og-image-en.png"}})[r],jt=t=>({title:t.title,meta:[{name:"description",content:t.description},{name:"keywords",content:t.keywords.join(", ")},{property:"og:title",content:t.ogTitle},{property:"og:description",content:t.ogDescription},{property:"og:image",content:t.ogImage},{property:"og:type",content:"website"},{name:"twitter:card",content:"summary_large_image"},{name:"twitter:title",content:t.ogTitle},{name:"twitter:description",content:t.ogDescription},{name:"twitter:image",content:t.ogImage}]}),kt=()=>{const{t}=h();return e.jsx("header",{className:"bg-white shadow-md",children:e.jsxs("div",{className:"container mx-auto px-4 py-4 flex justify-between items-center",children:[e.jsx("div",{className:"flex items-center",children:e.jsx(T,{to:"/",className:"text-2xl font-bold text-gray-800",children:t("app.title")})}),e.jsxs("nav",{className:"flex items-center space-x-4",children:[e.jsx(ft,{}),e.jsx(T,{to:"/login",className:"text-blue-600 hover:text-blue-800 transition duration-300",children:t("landingPage.cta.login")})]})]})})},wt=()=>{const{t}=h(),r=s=>{const n=t(s,{returnObjects:!0});return typeof n=="string"?[n]:Array.isArray(n)?n.filter(i=>typeof i=="string"):[]},a=[{title:t("landingPage.features.notification.title"),description:t("landingPage.features.notification.description"),details:r("landingPage.features.notification.details"),icon:"🔔"},{title:t("landingPage.features.inventory.title"),description:t("landingPage.features.inventory.description"),details:r("landingPage.features.inventory.details"),icon:"📦"},{title:t("landingPage.features.deviceTracking.title"),description:t("landingPage.features.deviceTracking.description"),details:r("landingPage.features.deviceTracking.details"),icon:"🔋"}];return e.jsx("section",{className:"py-16 bg-white",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-gray-900 mb-12",children:t("landingPage.features.title")}),e.jsx("div",{className:"grid md:grid-cols-3 gap-8",children:a.map((s,n)=>e.jsxs("div",{className:"text-center p-6 bg-gray-100 rounded-lg shadow-md hover:shadow-lg transition duration-300 group",children:[e.jsx("div",{className:"text-5xl mb-4 group-hover:scale-110 transition duration-300",children:s.icon}),e.jsx("h3",{className:"text-xl font-semibold text-gray-800 mb-3",children:s.title}),e.jsx("p",{className:"text-gray-600 mb-4",children:s.description}),e.jsx("ul",{className:"text-left text-gray-500 space-y-2 pl-5 list-disc",children:s.details.map((i,l)=>e.jsx("li",{children:i},l))})]},n))})]})})},Nt=()=>{const{t}=h();return e.jsx("section",{className:"py-16 bg-gray-50",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-center text-gray-900 mb-12",children:t("landingPage.planInfo.title")}),e.jsxs("div",{className:"max-w-2xl mx-auto text-center",children:[e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:t("landingPage.planInfo.description")}),e.jsx("div",{className:"flex justify-center space-x-4",children:e.jsx(T,{to:"/signup",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-300",children:t("landingPage.cta.signup")})})]})]})})},St=()=>{const{t}=h();return e.jsx("footer",{className:"bg-gray-100 py-12",children:e.jsxs("div",{className:"container mx-auto px-4",children:[e.jsxs("div",{className:"grid md:grid-cols-4 gap-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-800 mb-4",children:t("app.title")}),e.jsx("p",{className:"text-gray-600",children:t("landingPage.hero.subtitle")})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-4",children:t("landingPage.footer.contact")}),e.jsx("ul",{className:"space-y-2",children:e.jsx("li",{children:e.jsx("a",{href:"mailto:support@batterymanagement.com",className:"text-gray-600 hover:text-blue-600 transition duration-300",children:"メールでのお問い合わせ"})})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-4",children:"リーガル"}),e.jsxs("ul",{className:"space-y-2",children:[e.jsx("li",{children:e.jsx(T,{to:"/privacy",className:"text-gray-600 hover:text-blue-600 transition duration-300",children:t("landingPage.footer.privacyPolicy")})}),e.jsx("li",{children:e.jsx(T,{to:"/terms",className:"text-gray-600 hover:text-blue-600 transition duration-300",children:t("landingPage.footer.termsOfService")})})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-md font-semibold text-gray-700 mb-4",children:"サポート"}),e.jsx("ul",{className:"space-y-2",children:e.jsx("li",{children:e.jsx(T,{to:"/faq",className:"text-gray-600 hover:text-blue-600 transition duration-300",children:t("landingPage.footer.faq")})})})]})]}),e.jsx("div",{className:"mt-8 text-center text-gray-500 text-sm",children:t("landingPage.footer.copyright")})]})})},Pe=()=>{const{t}=h(),r=vt(t,"ja"),a=jt(r);return e.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[e.jsxs(Qe,{children:[e.jsx("title",{children:a.title}),a.meta.map((s,n)=>e.jsx("meta",{...s},n))]}),e.jsx(kt,{}),e.jsxs("main",{className:"flex-grow container mx-auto px-4 py-16",children:[e.jsxs("section",{className:"text-center mb-16",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-4",children:t("landingPage.hero.title")}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:t("landingPage.hero.subtitle")}),e.jsxs("div",{className:"flex justify-center items-center space-x-4",children:[e.jsx("a",{href:"/signup",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-300",children:t("landingPage.cta.signup")}),e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-800 transition duration-300",children:t("landingPage.hero.existingUser")})]})]}),e.jsx(wt,{}),e.jsx(Nt,{})]}),e.jsx(St,{})]})},Zr=()=>{const{t}=h(),r=vt(t,"en"),a=jt(r);return e.jsxs("div",{className:"min-h-screen bg-gray-100 flex flex-col",children:[e.jsxs(Qe,{children:[e.jsx("title",{children:a.title}),a.meta.map((s,n)=>e.jsx("meta",{...s},n))]}),e.jsx(kt,{}),e.jsxs("main",{className:"flex-grow container mx-auto px-4 py-16",children:[e.jsxs("section",{className:"text-center mb-16",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-4",children:t("landingPage.hero.title")}),e.jsx("p",{className:"text-xl text-gray-600 mb-8",children:t("landingPage.hero.subtitle")}),e.jsxs("div",{className:"flex justify-center items-center space-x-4",children:[e.jsx("a",{href:"/signup",className:"bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition duration-300",children:t("landingPage.cta.signup")}),e.jsx("a",{href:"/login",className:"text-blue-600 hover:text-blue-800 transition duration-300",children:t("landingPage.hero.existingUser")})]})]}),e.jsx(wt,{}),e.jsx(Nt,{})]}),e.jsx(St,{})]})};function Xr(){const{user:t,loading:r}=K();return lt(),r?e.jsx("div",{className:"min-h-screen flex items-center justify-center dark:bg-dark-bg",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 dark:border-blue-400"})}):e.jsx(Gt,{children:e.jsx($t,{children:e.jsxs("div",{className:"min-h-screen bg-gray-50 dark:bg-dark-bg",children:[t&&e.jsx(Zt,{}),e.jsxs("main",{className:t?"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6":"",children:[t&&e.jsx(Xt,{}),e.jsxs(Mt,{children:[e.jsx($,{path:"/",element:t?e.jsx(ge,{to:"/app/batteries",replace:!0}):e.jsx(Pe,{})}),e.jsx($,{path:"/ja",element:t?e.jsx(ge,{to:"/app/batteries",replace:!0}):e.jsx(Pe,{})}),e.jsx($,{path:"/en",element:t?e.jsx(ge,{to:"/app/batteries",replace:!0}):e.jsx(Zr,{})}),e.jsx($,{path:"/app/login",element:e.jsx(Jr,{})}),e.jsx($,{path:"/app/batteries",element:e.jsx(V,{children:e.jsx(Ka,{})})}),e.jsx($,{path:"/app/batteries/new",element:e.jsx(V,{children:e.jsx(xr,{})})}),e.jsx($,{path:"/app/batteries/:id",element:e.jsx(V,{children:e.jsx(ur,{})})}),e.jsx($,{path:"/app/devices",element:e.jsx(V,{children:e.jsx(jr,{})})}),e.jsx($,{path:"/app/devices/new",element:e.jsx(V,{children:e.jsx($r,{})})}),e.jsx($,{path:"/app/devices/:id",element:e.jsx(V,{children:e.jsx(Ar,{})})}),e.jsx($,{path:"/app/devices/:deviceId/select-battery",element:e.jsx(V,{children:e.jsx(zr,{})})}),e.jsx($,{path:"/app/settings",element:e.jsx(V,{children:e.jsx(Yr,{})})})]})]})]})})})}const es={title:"BattDevy"},ts={batteries:"電池",devices:"デバイス",new:"新規登録",selectBattery:"電池選択",detail:"デバイス詳細"},as={hero:{title:"電池切れの不安を解消する、スマートな電池管理アプリ",subtitle:"デバイスの電池状況をリアルタイムで追跡し、効率的に管理",existingUser:"アカウントをお持ちの方はこちら"},features:{title:"アプリの主な機能",notification:{title:"電池切れ通知",description:"デバイスの電池残量が少なくなると、事前に通知します。電池切れで困ることを防ぎます。",details:["リアルタイムの電池残量モニタリング","カスタマイズ可能な通知設定","複数のデバイスを同時に管理"]},inventory:{title:"電池在庫管理",description:"現在の電池在庫を簡単に把握。どの電池がどのデバイスで使用されているかを一目で確認できます。",details:["電池グループの作成と管理","使用中の電池と予備の電池を追跡","電池の状態（充電済み、使用中、廃棄）を管理"]},deviceTracking:{title:"デバイス電池追跡",description:"各デバイスの電池使用状況を追跡。いつ電池を交換すべきかを正確に把握できます。",details:["デバイスごとの電池寿命予測","電池交換履歴の記録","デバイスと電池の関連付け"]}},howItWorks:{title:"使い方",steps:[{title:"デバイスを登録",description:"使用中のデバイスを簡単に追加し、必要な電池の種類と数を設定"},{title:"電池グループを作成",description:"電池の在庫を管理し、各デバイスに適した電池を選択"},{title:"リアルタイム追跡",description:"電池残量と交換時期を常に把握し、事前に対策"}]},cta:{login:"ログインして始める",signup:"無料で新規登録"},planInfo:{title:"柔軟なプラン設定",description:"無料プランでは電池グループとデバイスをそれぞれ5つまで管理可能。将来的にプランをアップグレードして、より多くのデバイスと電池を管理できます。"},footer:{contact:"お問い合わせ",privacyPolicy:"プライバシーポリシー",termsOfService:"利用規約",faq:"よくある質問",copyright:"© 2025 BattDevy. All rights reserved."}},rs={image:{alt:"{{type}}の画像"},comments:{detailItem:"電池詳細画面の電池アイテムコンポーネント"},voltage:"電圧",detail:{memo:"メモ",count:"数量",shape:"形状",kind:"種類",title:"タイトル",item:{changeStatus:"状態変更",installationStatus:"設置状況",notInstalled:"未設置",changeStatusTitle:"電池 #{{number}} の状態を変更",lastChecked:"最終チェック",lastChanged:"最終交換",removeFromDevice:"デバイスから取り外す",usageHistory:"使用履歴",removeError:"電池の取り外しに失敗しました",updateStatusError:"電池の状態の更新に失敗しました",removeConfirmMessage:"{{deviceName}}から電池を取り外しますか？",removeConfirm:"取り外す"},cannotChangeCount:"使用中の電池があるため変更できません",cannotReduceCount:"デバイスに設定されている電池があるため、本数を減らすことはできません",cannotChangeKind:"使用中の電池があるため変更できません",memoPlaceholder:"メモを入力してください",cannotChangeShape:"使用中の電池があるため変更できません",titlePlaceholder:"タイトルを入力してください",imageSelectError:"画像選択エラー:",imageSelectFailed:"画像の選択に失敗しました",imageUploadError:"画像アップロード処理エラー:",imageUploadFailed:"画像のアップロードに失敗しました",imageAlt:"{{type}}の画像",cannotDelete:"デバイスに設定されている電池があるため削除できません"},shape:{d:"単1形",c:"単2形",aa:"単3形",aaa:"単4形",n:"単５形",lr44:"LR44/SR44",cr2032:"CR2032",cr2025:"CR2025",cr2016:"CR2016","9v":"9V形",other:"その他"},list:{filter:"フィルター",status:"ステータス",backToList:"一覧に戻る",individualSettings:"個別設定",deleteGroup:"電池グループの削除",deleteConfirmation:`「{{name}}」を削除してもよろしいですか？

※この操作は取り消せません。`,batteryStatus:"電池状態:",installedDevices:"設置中のデバイス:",unit:"本",total:"総数: {{count}}本",title:"電池一覧",noBatteries:"電池がありません",noMatchingBatteries:"条件に一致する電池がありません",emptyStateMessage:"新しい電池を登録して、効率的に管理を始めましょう。",noMatchingMessage:"検索条件やフィルター設定を変更して、再度お試しください。",addNew:"新規登録",groupCount:"電池グループ: {{current}} / {{max}}",limitReached:" (上限に達しています)",limitReachedSettings:"設定画面で制限数を変更できます",changeInSettings:"設定画面で変更",searchPlaceholder:"電池名・コメントを検索...",batteryType:"電池種別",resetFilter:"フィルターをリセット"},status:{charged:"満充電",in_use:"使用中",empty:"使用済み",disposed:"廃棄",unknown:"不明"},kind:{rechargeable:"充電池",disposable:"使い切り"},form:{title:"電池グループの新規登録",nameLabel:"グループ名",namePlaceholder:"例: リモコン用単3電池",statusLabel:"電池の状態",saving:"登録中...",submit:"登録する",limitReachedError:"電池グループの上限に達しています。設定ページで上限を解除できます。",createError:"電池の登録に失敗しました",limitReachedWarning:"電池グループの上限に達しています（{{current}}/{{max}}）。",upgradePlan:"プランをアップグレード",upgradeInDevelopment:"この機能は現在開発中です。",imageLabel:"画像",uploadImage:"画像を選択",imageHelp:"JPG、PNG、WebP形式の画像（5MB以下）"}},ss={detail:{type:"タイプ",deviceType:"デバイスタイプ",batteryLife:"電池寿命",batteryShape:"電池形状",batteryCount:"電池数",purchaseDate:"購入日",lastChange:"最終交換日",lastCheck:"最終チェック日",notes:"メモ",backToList:"一覧に戻る",imageAlt:"{{name}}の画像",cannotChangeBatteryShape:"電池が設定されているため変更できません",batteryLifePlaceholder:"例: 12",weeks:"週",weeksValue:"{{weeks}}週",notesPlaceholder:"メモを入力してください",installedBatteries:"設置済み: {{installed}}本 / 未設置: {{remaining}}本",deleteConfirmTitle:"デバイスの削除",deleteConfirmMessage:"「{{name}}」を削除してもよろしいですか？この操作は取り消せません。",cannotDelete:"電池が設置されているため削除できません"},list:{title:"デバイス一覧",searchPlaceholder:"デバイス名・メモを検索...",sortOptions:{none:"並び替え",batteryEndAsc:"交換予定日が近い順",batteryEndDesc:"交換予定日が遠い順",changeAsc:"交換日が古い順",changeDesc:"交換日が新しい順",nameAsc:"名前（昇順）",nameDesc:"名前（降順）"},deviceType:"デバイス種別",batteryType:"電池種別",resetFilter:"フィルターをリセット",noDevices:"デバイスがありません",emptyStateMessage:"新しいデバイスを登録して、効率的に管理を始めましょう。",noMatchingDevices:"条件に一致するデバイスがありません",noMatchingMessage:"検索条件やフィルター設定を変更して、再度お試しください。",withBatteries:"電池設定済みのデバイス",withoutBatteries:"電池未設定のデバイス",limitReached:"デバイスの上限に達しています",changeInSettings:"設定画面で変更",deviceCount:"デバイス: {{current}} / {{max}}",addNew:"新規登録",upgrade:"アップグレード",upgradeInDevelopment:"この機能は現在開発中です。",deleteGroup:"デバイスを削除"},types:{remotecontroller:"リモコン",speaker:"ラジオ/スピーカー",camera:"カメラ",gadget:"ガジェット",light:"ライト",toy:"おもちゃ",other:"その他"},batterySection:"電池情報",batterySlot:"電池スロット",selectBattery:"電池を選択",status:{batteryStatus:"電池状態:",batteryExchange:"電池交換:",hasBatteries:"電池設定完了",partiallySet:"電池設定不足",notSet:"電池未設定",exchangeDate:"交換日: {{date}}",scheduleDate:"予定日: {{date}}",overdue:"超過",soon:"まもなく",installedIn:"{{deviceName}}に設置中"},select:{backToDevice:"デバイス詳細に戻る",filter:"フィルター",history:"交換履歴",confirm:"選択を確定",saving:"設定中...",deviceNotFound:"デバイスが見つかりません",filterTitle:"フィルター",reset:"リセット",batteryStatus:"電池の状態",batteryType:"電池タイプ",settingTitle:"電池の設定",settingDescription:"{{deviceName}}に設定する電池({{batteryType}})を選択してください（最大{{count}}本）",noBatteries:"利用可能な電池がありません",registerNew:"{{batteryType}}の新しい電池を登録してください"},form:{title:"デバイスの新規登録",nameLabel:"デバイス名",batteryCountLabel:"必要本数",batteryLifeHelp:"電池の予想寿命を週単位で設定します。空欄の場合は通知されません。",saving:"登録中...",submit:"登録する",limitReachedError:"デバイスの上限に達しています。設定ページで上限を解除できます。",createError:"デバイスの登録に失敗しました",limitReachedWarning:"デバイスの上限に達しています（{{current}}/{{max}}）。",upgradePlan:"プランをアップグレード",upgradeInDevelopment:"この機能は現在開発中です。"}},ns={free:"無料",standard:"スタンダード",pro:"プロ"},is={title:"ユーザー設定",language:"言語設定",darkMode:{title:"ダークモード",description:"ダークモードの有効/無効を切り替えます",enabled:"有効",disabled:"無効"},planLimits:{title:"プラン情報",currentPlan:"現在のプラン: {{plan}}",batteryGroups:"電池グループ作成可能数",devices:"デバイス作成可能数",of:"/ {{max}}",upgrade:{title:"プランをアップグレード",description:{free:"現在のプランをstandardまたはproにアップグレードできます。",standard:"現在のプランをproにアップグレードできます。"},toStandard:"Standardプランへアップグレード",toPro:"Proプランへアップグレード",upgradeInDevelopment:"この機能は現在開発中です。"}},logout:{title:"ログアウト",description:"アカウントからログアウトします",button:"ログアウト",processing:"ログアウト中...",error:"ログアウトに失敗しました"}},ls={edit:"編集",save:"保存",cancel:"キャンセル",delete:"削除",loading:"読み込み中...",confirm:"確認",yes:"はい",no:"いいえ",unit:"本",purchase:"購入: {{date}}",all:"すべて",registrationDate:"登録日: {{date}}"},ds={app:es,nav:ts,landingPage:as,battery:rs,device:ss,plan:ns,userSettings:is,common:ls},os={title:"BattDevy"},cs={batteries:"Battery",devices:"Device",new:"New",selectBattery:"Select Battery",detail:"Device Details"},ms={hero:{title:"Eliminate Battery Anxiety with Smart Battery Management",subtitle:"Track and Manage Device Battery Status in Real-Time",existingUser:"Already have an account?"},features:{title:"Key Features",notification:{title:"Battery Depletion Alerts",description:"Get notified before your devices run out of battery. Prevent unexpected power failures.",details:["Real-time battery level monitoring","Customizable notification settings","Manage multiple devices simultaneously"]},inventory:{title:"Battery Inventory Management",description:"Easily track your battery inventory. See which batteries are used in which devices at a glance.",details:["Create and manage battery groups","Track used and spare batteries","Manage battery states (charged, in use, disposed)"]},deviceTracking:{title:"Device Battery Tracking",description:"Track battery usage for each device. Know exactly when to replace batteries.",details:["Battery life prediction per device","Record battery replacement history","Link devices with batteries"]}},howItWorks:{title:"How It Works",steps:[{title:"Register Devices",description:"Easily add your devices and set the battery type and quantity needed"},{title:"Create Battery Groups",description:"Manage battery inventory and select batteries for each device"},{title:"Real-time Tracking",description:"Always know battery levels and replacement times, plan ahead"}]},cta:{login:"Login to Get Started",signup:"Sign Up for Free"},planInfo:{title:"Flexible Plan Settings",description:"Free plan allows managing up to 5 battery groups and devices. Upgrade plans in the future to manage more devices and batteries."},footer:{contact:"Contact",privacyPolicy:"Privacy Policy",termsOfService:"Terms of Service",faq:"FAQ",copyright:"© 2025 BattDevy. All rights reserved."}},us={image:{alt:"{{type}} image"},comments:{detailItem:"Battery detail screen battery item component"},voltage:"Voltage",detail:{memo:"Memo",count:"Quantity",shape:"Shape",kind:"Type",title:"Title",item:{changeStatus:"Change Status",installationStatus:"Installation Status",notInstalled:"Not Installed",changeStatusTitle:"Change status of Battery #{{number}}",lastChecked:"Last Checked",lastChanged:"Last Changed",removeFromDevice:"Remove from Device",usageHistory:"Usage History",removeError:"Failed to remove battery",updateStatusError:"Failed to update battery status",removeConfirmMessage:"Remove battery from {{deviceName}}?",removeConfirm:"Remove"},cannotChangeCount:"Cannot change count due to batteries in use",cannotReduceCount:"Cannot reduce count due to batteries set in device",cannotChangeKind:"Cannot change type due to batteries in use",memoPlaceholder:"Enter memo",cannotChangeShape:"Cannot change shape due to batteries in use",titlePlaceholder:"Enter title",imageSelectError:"Image selection error:",imageSelectFailed:"Failed to select image",imageUploadError:"Image upload processing error:",imageUploadFailed:"Failed to upload image",imageAlt:"{{type}} image",cannotDelete:"Cannot delete due to batteries set in device"},shape:{d:"D",c:"C",aa:"AA",aaa:"AAA",n:"N",lr44:"LR44/SR44",cr2032:"CR2032",cr2025:"CR2025",cr2016:"CR2016","9v":"9V",other:"Other"},list:{filter:"Filter",status:"Status",backToList:"Back to List",individualSettings:"Individual Settings",deleteGroup:"Delete Battery Group",deleteConfirmation:`Are you sure you want to delete "{{name}}"?

※This operation cannot be undone.`,batteryStatus:"Battery Status:",installedDevices:"Installed Devices:",unit:"pcs",total:"Total: {{count}} pcs",title:"Battery List",noBatteries:"No Batteries",noMatchingBatteries:"No batteries match the criteria",emptyStateMessage:"Register new batteries and start managing efficiently.",noMatchingMessage:"Change search conditions or filter settings and try again.",addNew:"New Registration",groupCount:"Battery Groups: {{current}} / {{max}}",limitReached:" (Limit Reached)",limitReachedSettings:"Change limit in settings",changeInSettings:"Change in Settings",searchPlaceholder:"Search battery name or comment...",batteryType:"Battery Type",resetFilter:"Reset Filter"},status:{charged:"Fully Charged",in_use:"In Use",empty:"Depleted",disposed:"Disposed",unknown:"Unknown"},kind:{rechargeable:"Rechargeable",disposable:"Disposable"},form:{title:"New Battery Group Registration",nameLabel:"Group Name",namePlaceholder:"e.g., Remote Control AA Batteries",statusLabel:"Battery Status",saving:"Registering...",submit:"Register",limitReachedError:"Battery group limit reached. Unlock limit in settings page.",createError:"Failed to register battery",limitReachedWarning:"Battery group limit reached ({{current}}/{{max}}).",upgradePlan:"Upgrade Plan",upgradeInDevelopment:"This feature is currently under development.",imageLabel:"Image",uploadImage:"Select Image",imageHelp:"JPG, PNG, WebP formats (under 5MB)"}},gs={detail:{type:"Type",deviceType:"Device Type",batteryLife:"Battery Life",batteryShape:"Battery Shape",batteryCount:"Battery Count",purchaseDate:"Purchase Date",lastChange:"Last Replacement",lastCheck:"Last Check",notes:"Memo",backToList:"Back to List",imageAlt:"{{name}} image",cannotChangeBatteryShape:"Cannot change due to batteries set",batteryLifePlaceholder:"e.g., 12",weeks:"weeks",weeksValue:"{{weeks}} weeks",notesPlaceholder:"Enter memo",installedBatteries:"Installed: {{installed}} pcs / Remaining: {{remaining}} pcs",deleteConfirmTitle:"Delete Device",deleteConfirmMessage:'Are you sure you want to delete "{{name}}"? This action cannot be undone.',cannotDelete:"Cannot delete device with installed batteries"},list:{title:"Device List",searchPlaceholder:"Search device name or memo...",sortOptions:{none:"Sort",batteryEndAsc:"Nearest replacement date",batteryEndDesc:"Farthest replacement date",changeAsc:"Oldest replacement",changeDesc:"Newest replacement",nameAsc:"Name (Ascending)",nameDesc:"Name (Descending)"},deviceType:"Device Type",batteryType:"Battery Type",resetFilter:"Reset Filter",noDevices:"No Devices",emptyStateMessage:"Register new devices and start managing efficiently.",noMatchingDevices:"No devices match the criteria",noMatchingMessage:"Change search conditions or filter settings and try again.",withBatteries:"Devices with Batteries",withoutBatteries:"Devices without Batteries",limitReached:"Device limit reached",changeInSettings:"Change in Settings",deviceCount:"Devices: {{current}} / {{max}}",addNew:"New Registration",upgrade:"Upgrade",upgradeInDevelopment:"This feature is currently under development.",deleteGroup:"Delete Device"},types:{remotecontroller:"Remote Control",speaker:"Radio/Speaker",camera:"Camera",gadget:"Gadget",light:"Light",toy:"Toy",other:"Other"},batterySection:"Battery Information",batterySlot:"Battery Slot",selectBattery:"Select Battery",status:{batteryStatus:"Battery Status:",batteryExchange:"Battery Exchange:",hasBatteries:"Batteries Set",partiallySet:"Batteries Partially Set",notSet:"No Batteries Set",exchangeDate:"Exchange Date: {{date}}",scheduleDate:"Scheduled Date: {{date}}",overdue:"Overdue",soon:"Soon",installedIn:"Installed in {{deviceName}}"},select:{backToDevice:"Back to Device Details",filter:"Filter",history:"Exchange History",confirm:"Confirm Selection",saving:"Setting...",deviceNotFound:"Device Not Found",filterTitle:"Filter",reset:"Reset",batteryStatus:"Battery Status",batteryType:"Battery Type",settingTitle:"Battery Setting",settingDescription:"Select batteries ({{batteryType}}) to set for {{deviceName}} (Max {{count}} pcs)",noBatteries:"No available batteries",registerNew:"Register new {{batteryType}} batteries"},form:{title:"New Device Registration",nameLabel:"Device Name",batteryCountLabel:"Required Quantity",batteryLifeHelp:"Set expected battery life in weeks. Leave blank for no notifications.",saving:"Registering...",submit:"Register",limitReachedError:"Device limit reached. Unlock limit in settings page.",createError:"Failed to register device",limitReachedWarning:"Device limit reached ({{current}}/{{max}}).",upgradePlan:"Upgrade Plan",upgradeInDevelopment:"This feature is currently under development."}},xs={free:"Free",standard:"Standard",pro:"Pro"},hs={title:"User Settings",language:"Language Settings",darkMode:{title:"Dark Mode",description:"Toggle dark mode on/off",enabled:"Enabled",disabled:"Disabled"},planLimits:{title:"Plan Information",currentPlan:"Current Plan: {{plan}}",batteryGroups:"Maximum Battery Groups",devices:"Maximum Devices",of:"/ {{max}}",upgrade:{title:"Upgrade Plan",description:{free:"You can upgrade to standard or pro plan.",standard:"You can upgrade to pro plan."},toStandard:"Upgrade to Standard Plan",toPro:"Upgrade to Pro Plan",upgradeInDevelopment:"This feature is currently under development."}},logout:{title:"Logout",description:"Sign out from your account",button:"Logout",processing:"Logging out...",error:"Failed to logout"}},bs={edit:"Edit",save:"Save",cancel:"Cancel",delete:"Delete",loading:"Loading...",confirm:"Confirm",yes:"Yes",no:"No",unit:"pcs",purchase:"Purchased: {{date}}",all:"All",registrationDate:"Registered: {{date}}"},ys={app:os,nav:cs,landingPage:ms,battery:us,device:gs,plan:xs,userSettings:hs,common:bs},ps={ja:{translation:ds},en:{translation:ys}};Ut.use(Ot).use(Kt).init({resources:ps,fallbackLng:"ja",debug:!1,interpolation:{escapeValue:!1},detection:{order:["localStorage","navigator"],caches:["localStorage"]}});const fs=new qt({defaultOptions:{queries:{refetchOnWindowFocus:!1,retry:1}}});Ht(document.getElementById("root")).render(e.jsx(u.StrictMode,{children:e.jsx(Wt,{client:fs,children:e.jsx(Jt,{children:e.jsx(Xr,{})})})}));
